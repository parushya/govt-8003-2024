<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Matching – Lab for Quantitative Methods - 3</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./equivalence.html" rel="next">
<link href="./matching-equivalence.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="site_libs/datatables-binding-0.33/datatables.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="www/styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./matching-equivalence.html">Session 2 - Matching and Equivalence</a></li><li class="breadcrumb-item"><a href="./matching.html">Matching</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Lab for Quantitative Methods - 3</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Why are we here?</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./latex-quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Session 1 - <span class="math inline">\(\LaTeX\)</span> and Quarto</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./matching-equivalence.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Session 2 - Matching and Equivalence</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./matching.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Matching</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./equivalence.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Equivalence</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missing-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Session 3 - Missing Data and Multiple Imputation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#building-the-intuition-stratification-or-subclassification" id="toc-building-the-intuition-stratification-or-subclassification" class="nav-link active" data-scroll-target="#building-the-intuition-stratification-or-subclassification">Building the intuition: Stratification or Subclassification</a></li>
  <li><a href="#exact-matching" id="toc-exact-matching" class="nav-link" data-scroll-target="#exact-matching">Exact Matching</a>
  <ul class="collapse">
  <li><a href="#treatment-group" id="toc-treatment-group" class="nav-link" data-scroll-target="#treatment-group">Treatment Group</a></li>
  <li><a href="#control-group" id="toc-control-group" class="nav-link" data-scroll-target="#control-group">Control Group</a></li>
  </ul></li>
  <li><a href="#propensity-score-matching" id="toc-propensity-score-matching" class="nav-link" data-scroll-target="#propensity-score-matching">Propensity Score Matching</a>
  <ul class="collapse">
  <li><a href="#propensity-score-matching-on-treatment-and-control" id="toc-propensity-score-matching-on-treatment-and-control" class="nav-link" data-scroll-target="#propensity-score-matching-on-treatment-and-control">Propensity Score Matching on Treatment and Control</a></li>
  <li><a href="#taking-a-different-smaller-set-of-covariates" id="toc-taking-a-different-smaller-set-of-covariates" class="nav-link" data-scroll-target="#taking-a-different-smaller-set-of-covariates">Taking a different (smaller) set of covariates</a></li>
  <li><a href="#propesnity-score-density" id="toc-propesnity-score-density" class="nav-link" data-scroll-target="#propesnity-score-density">Propesnity Score Density</a></li>
  </ul></li>
  <li><a href="#how-to-use-matching" id="toc-how-to-use-matching" class="nav-link" data-scroll-target="#how-to-use-matching">How to Use Matching</a>
  <ul class="collapse">
  <li><a href="#match-on-covariates" id="toc-match-on-covariates" class="nav-link" data-scroll-target="#match-on-covariates">Match on Covariates</a></li>
  <li><a href="#match-on-propensity-scores" id="toc-match-on-propensity-scores" class="nav-link" data-scroll-target="#match-on-propensity-scores">Match on Propensity Scores</a></li>
  <li><a href="#explore-the-matches" id="toc-explore-the-matches" class="nav-link" data-scroll-target="#explore-the-matches">Explore the matches</a></li>
  <li><a href="#incorporating-region-wise-exact-matching" id="toc-incorporating-region-wise-exact-matching" class="nav-link" data-scroll-target="#incorporating-region-wise-exact-matching">Incorporating region wise exact matching</a></li>
  <li><a href="#comparing-ols-with-matched-difference-of-means" id="toc-comparing-ols-with-matched-difference-of-means" class="nav-link" data-scroll-target="#comparing-ols-with-matched-difference-of-means">Comparing OLS with Matched Difference of Means</a></li>
  </ul></li>
  <li><a href="#additional-links" id="toc-additional-links" class="nav-link" data-scroll-target="#additional-links">Additional Links</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./matching-equivalence.html">Session 2 - Matching and Equivalence</a></li><li class="breadcrumb-item"><a href="./matching.html">Matching</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Matching</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Setup</strong></p>
<p>I use the following setup on the top of all <code>RMD/QMD</code> files to load basic packages.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># I use function that checks if a package is already loaded - if not loads it</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># No more install.library stuff</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>check.packages <span class="ot">&lt;-</span> <span class="cf">function</span>(pkg) {</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  new.pkg <span class="ot">&lt;-</span> pkg[<span class="sc">!</span>(pkg <span class="sc">%in%</span> <span class="fu">installed.packages</span>()[, <span class="st">"Package"</span>])]</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(new.pkg)) {</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">install.packages</span>(new.pkg, <span class="at">dependencies =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sapply</span>(pkg, require, <span class="at">character.only =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># A vector of packages I think would be needed</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>packages <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"janitor"</span>, <span class="st">"tidyverse"</span>, <span class="co"># Packages for data wrangling</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>              <span class="st">"here"</span>, <span class="co"># Will help you get rid of writing long path names for files</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>              <span class="st">"kableExtra"</span>,<span class="st">"stargazer"</span>, <span class="co"># For nice looking tabular output</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>               <span class="st">"readstata13"</span>,<span class="st">"haven"</span> <span class="co"># For loading stata files</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if packages are installed and loaded using the function created above</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="fu">check.packages</span>(packages)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<section id="building-the-intuition-stratification-or-subclassification" class="level2">
<h2 class="anchored" data-anchor-id="building-the-intuition-stratification-or-subclassification">Building the intuition: Stratification or Subclassification</h2>
<p>For approaching the causal effects, in the language of DAGs, we have to close all the backdoor paths between our treatment and outcome of interest. Let’s see that with an illustrative example from <em>Causal Inference: The Mixtape</em> <span class="citation" data-cites="cunninghamCausalInferenceMixtape">(<a href="references.html#ref-cunninghamCausalInferenceMixtape" role="doc-biblioref">Cunningham, n.d.</a>)</span></p>
<p><strong>Research Question:</strong> Would being in <em>First Class</em> in titanic have increased the chances of survival? As a causal effect can we isolate it?</p>
<p>First class was located higher on the ship and therefore likely led to a greater chance of getting into one of the few lifeboats onboard. We could estimate the ATE of being in first class like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to load data from Causal Mixtape github page</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>read_data <span class="ot">&lt;-</span> <span class="cf">function</span>(df)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  full_path <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"https://github.com/scunning1975/mixtape/raw/master/"</span>, </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>                     df, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(full_path) <span class="co"># To show what was the final url accessed</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(full_path)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load data and create a variable "d" for individuals in first class</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>titanic <span class="ot">&lt;-</span> <span class="fu">read_data</span>(<span class="st">"titanic.dta"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">d =</span> <span class="fu">case_when</span>(class <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="dv">1</span>, <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "https://github.com/scunning1975/mixtape/raw/master/titanic.dta"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate expected outcome for the treatment group - first class </span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>ey1 <span class="ot">&lt;-</span> titanic <span class="sc">%&gt;%</span> </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(d <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(survived) <span class="sc">%&gt;%</span> </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>()</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>ey1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6246154</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate expected outcome for the control group - all other classes onboard </span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>ey0 <span class="ot">&lt;-</span> titanic <span class="sc">%&gt;%</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(d <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(survived) <span class="sc">%&gt;%</span> </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>()</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>ey0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2707889</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the simple difference in outcomes </span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>(sdo <span class="ot">&lt;-</span> ey1 <span class="sc">-</span> ey0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3538265</code></pre>
</div>
</div>
<p>Say in our research, we learn that women and children were more likely to be in first class because only wealthy families could afford this kind of travel. Additionally, the social norm during the boarding of the lifeboats was that women and children got first priority. Now we have a problem because being a woman or a child are confounders, which means that our estimate of the ATE is biased.</p>
<p>We can handle this via stratification by a bit of data wrangling</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a variable to indicate each of our strata - two for sex (male = 1), and two for age(adult = 1)</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>titanic <span class="ot">=</span> titanic <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">s =</span> <span class="fu">case_when</span>(sex <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> age <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>                       sex <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> age <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>                       sex <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> age <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>                       sex <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> age <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">4</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>                       <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">0</span>))</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co"># create treatment variable for those in first class</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>titanic <span class="ot">&lt;-</span> titanic <span class="sc">%&gt;%</span> </span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">d =</span> <span class="fu">case_when</span>(class <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="dv">1</span>, <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">0</span>))</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate survival rate for each pair of strata and treatment</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>ey11 <span class="ot">&lt;-</span> titanic <span class="sc">%&gt;%</span> </span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(s <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> d <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(survived) <span class="sc">%&gt;%</span> </span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>()</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>ey10 <span class="ot">&lt;-</span> titanic <span class="sc">%&gt;%</span> </span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(s <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> d <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(survived) <span class="sc">%&gt;%</span> </span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>()</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>ey21 <span class="ot">&lt;-</span> titanic <span class="sc">%&gt;%</span> </span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(s <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> d <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(survived) <span class="sc">%&gt;%</span> </span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>()</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>ey20 <span class="ot">&lt;-</span> titanic <span class="sc">%&gt;%</span> </span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(s <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> d <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(survived) <span class="sc">%&gt;%</span> </span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>()</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>ey31 <span class="ot">&lt;-</span> titanic <span class="sc">%&gt;%</span> </span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(s <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> d <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(survived) <span class="sc">%&gt;%</span> </span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>()</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>ey30 <span class="ot">&lt;-</span> titanic <span class="sc">%&gt;%</span> </span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(s <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> d <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(survived) <span class="sc">%&gt;%</span> </span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>()</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>ey41 <span class="ot">&lt;-</span> titanic <span class="sc">%&gt;%</span> </span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(s <span class="sc">==</span> <span class="dv">4</span> <span class="sc">&amp;</span> d <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(survived) <span class="sc">%&gt;%</span> </span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>()</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>ey40 <span class="ot">&lt;-</span> titanic <span class="sc">%&gt;%</span> </span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(s <span class="sc">==</span> <span class="dv">4</span> <span class="sc">&amp;</span> d <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(survived) <span class="sc">%&gt;%</span> </span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>()</span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate differences between strata</span></span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>diff1 <span class="ot">=</span> ey11 <span class="sc">-</span> ey10</span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>diff2 <span class="ot">=</span> ey21 <span class="sc">-</span> ey20</span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>diff3 <span class="ot">=</span> ey31 <span class="sc">-</span> ey30</span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>diff4 <span class="ot">=</span> ey41 <span class="sc">-</span> ey40</span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate number of control units </span></span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>obs <span class="ot">=</span> <span class="fu">nrow</span>(titanic <span class="sc">%&gt;%</span> <span class="fu">filter</span>(d <span class="sc">==</span> <span class="dv">0</span>))</span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a><span class="co"># create weights for each strata</span></span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>wt1 <span class="ot">&lt;-</span> titanic <span class="sc">%&gt;%</span> </span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(s <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> d <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>(.)<span class="sc">/</span>obs</span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a>wt2 <span class="ot">&lt;-</span> titanic <span class="sc">%&gt;%</span> </span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(s <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> d <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>(.)<span class="sc">/</span>obs</span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a>wt3 <span class="ot">&lt;-</span> titanic <span class="sc">%&gt;%</span> </span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(s <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> d <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>(.)<span class="sc">/</span>obs</span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a>wt4 <span class="ot">&lt;-</span> titanic <span class="sc">%&gt;%</span> </span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(s <span class="sc">==</span> <span class="dv">4</span> <span class="sc">&amp;</span> d <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-77"><a href="#cb11-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>(.)<span class="sc">/</span>obs</span>
<span id="cb11-78"><a href="#cb11-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-79"><a href="#cb11-79" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate weighted average treatment effect</span></span>
<span id="cb11-80"><a href="#cb11-80" aria-hidden="true" tabindex="-1"></a>(<span class="at">wate =</span> diff1<span class="sc">*</span>wt1 <span class="sc">+</span> diff2<span class="sc">*</span>wt2 <span class="sc">+</span> diff3<span class="sc">*</span>wt3 <span class="sc">+</span> diff4<span class="sc">*</span>wt4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1887847</code></pre>
</div>
</div>
</section>
<section id="exact-matching" class="level2">
<h2 class="anchored" data-anchor-id="exact-matching">Exact Matching</h2>
<p>Example from <em>Causal Inference: The Mixtape</em> by Scott Cunningham.</p>
<p>Do training programs have a causal effect on earnings?.</p>
<p>But, in this very simple example, we notice that individuals who participated in the training program are younger on average than those in the control group (What type of bias is this?).</p>
<p>This violates the conditional independence assumption. We can address this using exact matching on age as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load data </span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>training_example <span class="ot">&lt;-</span> <span class="fu">read_data</span>(<span class="st">"training_example.dta"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "https://github.com/scunning1975/mixtape/raw/master/training_example.dta"</code></pre>
</div>
</div>
<div class="sourceCode" id="cb15"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="in">#| echo: true</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="in">#| output: asis</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="in"># view data table to see what matching on age looks like </span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="in">View(training_example)</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This dataset is for illustration where we have exact matches for all units in the treated group on the covariate of age from the control group.</p>
<div class="cell">
<div class="cell-output-display">
<div style="font-size: 10px;">
<div class="datatables html-widget html-fill-item" id="htmlwidget-59c1925dad36166a74d6" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-59c1925dad36166a74d6">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20"],[1,2,3,4,5,6,7,8,9,10,null,null,null,null,null,null,null,null,null,null],[18,29,24,27,33,22,19,20,21,30,null,null,null,null,null,null,null,null,null,null],["9500","12250","11000","11750","13250","10500","9750","10000","10250","12500","","","","","","","","","",""],[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20],[20,27,21,39,38,29,39,33,24,30,33,36,22,18,43,39,19,30,51,48],[8500,10075,8725,12775,12550,10525,12775,11425,9400,10750,11425,12100,8950,8050,13675,12775,8275,9000,15475,14800],[1,2,3,4,5,6,7,8,9,10,null,null,null,null,null,null,null,null,null,null],[18,29,24,27,33,22,19,20,21,30,null,null,null,null,null,null,null,null,null,null],[8050,10525,9400,10075,11425,8950,8275,8500,8725,9875,null,null,null,null,null,null,null,null,null,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>unit_treat<\/th>\n      <th>age_treat<\/th>\n      <th>earnings_treat<\/th>\n      <th>unit_control<\/th>\n      <th>age_control<\/th>\n      <th>earnings_control<\/th>\n      <th>unit_matched<\/th>\n      <th>age_matched<\/th>\n      <th>earnings_matched<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":50,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,2,4,5,6,7,8,9]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"unit_treat","targets":1},{"name":"age_treat","targets":2},{"name":"earnings_treat","targets":3},{"name":"unit_control","targets":4},{"name":"age_control","targets":5},{"name":"earnings_control","targets":6},{"name":"unit_matched","targets":7},{"name":"age_matched","targets":8},{"name":"earnings_matched","targets":9}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<p>Let’s see the distribution of covariate age in the two groups.<br>
::: {.panel-tabset}</p>
<section id="treatment-group" class="level3">
<h3 class="anchored" data-anchor-id="treatment-group">Treatment Group</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># histogram of age for treatment group - mean at red line</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(training_example, <span class="fu">aes</span>(<span class="at">x=</span>age_treat)) <span class="sc">+</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">10</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="fu">mean</span>(age_treat, <span class="at">na.rm =</span> T)), <span class="at">color =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="matching_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="control-group" class="level3">
<h3 class="anchored" data-anchor-id="control-group">Control Group</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># histogram of age for control group - mean at red line</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(training_example, <span class="fu">aes</span>(<span class="at">x=</span>age_control)) <span class="sc">+</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">10</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="fu">mean</span>(age_control, <span class="at">na.rm =</span> T)), <span class="at">color =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="matching_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>::: <br></p>
<p>After exact matching</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># histogram of age for matched group - mean at red line</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(training_example, <span class="fu">aes</span>(<span class="at">x=</span>age_matched))<span class="sc">+</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">10</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="fu">mean</span>(age_matched, <span class="at">na.rm =</span> T)), <span class="at">color =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="matching_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate mean wages for treatment group </span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>trained <span class="ot">=</span> training_example <span class="sc">%&gt;%</span> </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(age_treat)) <span class="sc">%&gt;%</span> </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">earnings_treat =</span> <span class="fu">as.numeric</span>(earnings_treat)) <span class="sc">%&gt;%</span> </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(earnings_treat) <span class="sc">%&gt;%</span> </span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>()</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate mean wages for matched control group </span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>nontrained <span class="ot">=</span> training_example <span class="sc">%&gt;%</span> </span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(age_matched)) <span class="sc">%&gt;%</span> </span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">earnings_matched =</span> <span class="fu">as.numeric</span>(earnings_matched)) <span class="sc">%&gt;%</span> </span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(earnings_matched) <span class="sc">%&gt;%</span> </span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>()</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>att_train <span class="ot">=</span> trained <span class="sc">-</span> nontrained <span class="co"># Notice - This is the ATT </span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>att_train</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1695</code></pre>
</div>
</div>
</section>
</section>
<section id="propensity-score-matching" class="level2">
<h2 class="anchored" data-anchor-id="propensity-score-matching">Propensity Score Matching</h2>
<p>Replication data for Samuels and Shugart’s book “Presidents, Parties and Prime Ministers: How the Separation of Powers Affects Party Organization and Behavior” Cambridge University press, 2010 (Data extended by students from U-Mich).</p>
<p><strong>Treatment</strong> here is the type of system i.e.&nbsp;Presidential or Parlimentary.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load data</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/matching_data.csv"</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># summarize the data</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data<span class="sc">$</span>purepres) <span class="co"># treatment</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.0000  0.0000  0.0000  0.3068  1.0000  1.0000 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data<span class="sc">$</span>pureparl) <span class="co"># control</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.0000  0.0000  0.0000  0.4205  1.0000  1.0000 </code></pre>
</div>
</div>
<section id="exploratory-data-analysis" class="level4">
<h4 class="anchored" data-anchor-id="exploratory-data-analysis">Exploratory Data Analysis</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a table to see the count of each type of system in our data set</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="fu">case_when</span>( purepres<span class="sc">==</span><span class="dv">1</span> <span class="sc">~</span> <span class="st">"PRES"</span>,</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>                      pureparl<span class="sc">==</span><span class="dv">1</span> <span class="sc">~</span> <span class="st">"PARL"</span>,</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>                      presparlpres<span class="sc">==</span><span class="dv">1</span> <span class="sc">|</span> premiprespres<span class="sc">==</span><span class="dv">1</span> <span class="sc">|</span>presparlpm <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"MIXED"</span>,</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>                      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>                      )</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking Distribution</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(data<span class="sc">$</span>type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
MIXED  PARL  PRES 
    9    37    27 </code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p>Let’s check the distribution stratified by continents</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="in">(data %&gt;% select(type, continent, damerica) %&gt;% </span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(continent, type) %&gt;% </span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(n = n())</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-aa9d0c96db041da21a16" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-aa9d0c96db041da21a16">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16"],["Africa","Africa","Africa","Africa","Asia","Asia","Asia","Asia","Europe","Europe","Europe","North America","North America","Oceania","South America","South America"],["MIXED","PARL","PRES",null,"MIXED","PARL","PRES",null,"MIXED","PARL",null,"PARL","PRES","PARL","MIXED","PRES"],[3,4,5,2,2,10,4,2,3,16,11,3,9,4,1,9]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>continent<\/th>\n      <th>type<\/th>\n      <th>n<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":50,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":3},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"continent","targets":1},{"name":"type","targets":2},{"name":"n","targets":3}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
</div>
</div>
<p>Why might this distribution create a problem? (<em>Hint</em>: Think about balance/overlap)</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" aria-current="page">Wrangling Dataset</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Summary of Data</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create dataset of covariates of interest</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(indviol, year_indep, dindep_decol, dindep_seces,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>               chrstprotpct, chrstcatpct, judgenpct,</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>               islmgenpct, budgenpct,</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>               a_ethnic, a_ling, a_relig,</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>               gini,</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>               land_kilometers,</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>               life_expectency_1800, gdp_per_capita_1800,</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>               density,</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>               damerica, dsouthamerica, deurope, dafrica,</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>               dasia, doceania,</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>               colony_esp, colony_gbr, colony_fra, colony_prt, colony_oeu,</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>               rugged</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the variables </span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(X) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Violent Independence"</span>, <span class="st">"Year of Independence"</span>, <span class="st">"Independency by Decolonization"</span>,</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Independence by Secession"</span>, <span class="st">"Christian Protestant Pct"</span>, <span class="st">"Christian Catholic Pct"</span>, </span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Jewish Pct"</span>, <span class="st">"Islam Pct"</span>, <span class="st">"Budhist Pct"</span>,</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Ethic Fractionalization"</span>, <span class="st">"Linguistic Fractionalization"</span>, <span class="st">"Religious Fractionalization"</span>,</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Gini"</span>,</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Land (km)"</span>,</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Life expectancy 1800"</span>, <span class="st">"GDP per cap 1800"</span>,</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Population density"</span>,</span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Country in America"</span>, <span class="st">"Country in South America"</span>, <span class="st">"Country in Europe"</span>, <span class="st">"Country in Africa"</span>, <span class="st">"Country in Asia"</span>, <span class="st">"Country in Oceania"</span>,</span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Spanish colony"</span>, <span class="st">"British colony"</span>, <span class="st">"France colony"</span>, <span class="st">"Portugal colony"</span>, <span class="st">"OEU colony"</span>,</span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Ruggedness"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceCode" id="cb29"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="in">#we summarize X</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="in">summary(X)</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">#we summarize X</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(X)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Violent Independence Year of Independence Independency by Decolonization
 Min.   :0.0000       Min.   : 943         Min.   :0.0000                
 1st Qu.:0.0000       1st Qu.:1827         1st Qu.:0.0000                
 Median :1.0000       Median :1918         Median :1.0000                
 Mean   :0.5568       Mean   :1843         Mean   :0.5114                
 3rd Qu.:1.0000       3rd Qu.:1960         3rd Qu.:1.0000                
 Max.   :1.0000       Max.   :1993         Max.   :1.0000                
                                                                         
 Independence by Secession Christian Protestant Pct Christian Catholic Pct
 Min.   :0.0000            Min.   :0.0000           Min.   :0.00000       
 1st Qu.:0.0000            1st Qu.:0.0015           1st Qu.:0.00905       
 Median :0.0000            Median :0.0181           Median :0.17000       
 Mean   :0.2727            Mean   :0.1179           Mean   :0.38277       
 3rd Qu.:1.0000            3rd Qu.:0.0735           3rd Qu.:0.88380       
 Max.   :1.0000            Max.   :0.9900           Max.   :0.98040       
                           NA's   :1                NA's   :1             
   Jewish Pct        Islam Pct       Budhist Pct      Ethic Fractionalization
 Min.   :0.00000   Min.   :0.0000   Min.   :0.00000   Min.   :0.001998       
 1st Qu.:0.00000   1st Qu.:0.0000   1st Qu.:0.00000   1st Qu.:0.181835       
 Median :0.00020   Median :0.0022   Median :0.00000   Median :0.406181       
 Mean   :0.01297   Mean   :0.1309   Mean   :0.03390   Mean   :0.395852       
 3rd Qu.:0.00205   3rd Qu.:0.1146   3rd Qu.:0.00035   3rd Qu.:0.591322       
 Max.   :0.87530   Max.   :0.9947   Max.   :0.88540   Max.   :0.879100       
 NA's   :1         NA's   :1        NA's   :1                                
 Linguistic Fractionalization Religious Fractionalization      Gini      
 Min.   :0.002113             Min.   :0.002755            Min.   :19.40  
 1st Qu.:0.087104             1st Qu.:0.220886            1st Qu.:36.50  
 Median :0.303091             Median :0.408493            Median :45.10  
 Mean   :0.338181             Mean   :0.423653            Mean   :43.65  
 3rd Qu.:0.546679             3rd Qu.:0.615734            3rd Qu.:51.70  
 Max.   :0.873408             Max.   :0.860260            Max.   :73.90  
 NA's   :1                                                NA's   :7      
   Land (km)        Life expectancy 1800 GDP per cap 1800 Population density 
 Min.   :    2030   Min.   :25.10        Min.   : 368     Min.   :  0.02199  
 1st Qu.:   60625   1st Qu.:30.16        1st Qu.: 740     1st Qu.:  1.13435  
 Median :  228780   Median :32.90        Median : 976     Median :  8.99563  
 Mean   :  964830   Mean   :32.67        Mean   :1099     Mean   : 15.92361  
 3rd Qu.:  656352   3rd Qu.:35.73        3rd Qu.:1442     3rd Qu.: 19.66593  
 Max.   :16376870   Max.   :40.00        Max.   :2892     Max.   :121.29887  
                                         NA's   :1                           
 Country in America Country in South America Country in Europe
 Min.   :0.00       Min.   :0.0000           Min.   :0.0000   
 1st Qu.:0.00       1st Qu.:0.0000           1st Qu.:0.0000   
 Median :0.00       Median :0.0000           Median :0.0000   
 Mean   :0.25       Mean   :0.1136           Mean   :0.3409   
 3rd Qu.:0.25       3rd Qu.:0.0000           3rd Qu.:1.0000   
 Max.   :1.00       Max.   :1.0000           Max.   :1.0000   
                                                              
 Country in Africa Country in Asia  Country in Oceania Spanish colony  
 Min.   :0.0000    Min.   :0.0000   Min.   :0.00000    Min.   :0.0000  
 1st Qu.:0.0000    1st Qu.:0.0000   1st Qu.:0.00000    1st Qu.:0.0000  
 Median :0.0000    Median :0.0000   Median :0.00000    Median :0.0000  
 Mean   :0.1591    Mean   :0.2045   Mean   :0.04545    Mean   :0.2152  
 3rd Qu.:0.0000    3rd Qu.:0.0000   3rd Qu.:0.00000    3rd Qu.:0.0000  
 Max.   :1.0000    Max.   :1.0000   Max.   :1.00000    Max.   :1.0000  
                                                       NA's   :9       
 British colony   France colony     Portugal colony     OEU colony     
 Min.   :0.0000   Min.   :0.00000   Min.   :0.00000   Min.   :0.00000  
 1st Qu.:0.0000   1st Qu.:0.00000   1st Qu.:0.00000   1st Qu.:0.00000  
 Median :0.0000   Median :0.00000   Median :0.00000   Median :0.00000  
 Mean   :0.2785   Mean   :0.05063   Mean   :0.02532   Mean   :0.02532  
 3rd Qu.:1.0000   3rd Qu.:0.00000   3rd Qu.:0.00000   3rd Qu.:0.00000  
 Max.   :1.0000   Max.   :1.00000   Max.   :1.00000   Max.   :1.00000  
 NA's   :9        NA's   :9         NA's   :9         NA's   :9        
   Ruggedness    
 Min.   :0.0370  
 1st Qu.:0.4255  
 Median :1.0130  
 Mean   :1.2591  
 3rd Qu.:1.7745  
 Max.   :5.0430  
 NA's   :9       </code></pre>
</div>
</div>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="checking-balance-of-covariates" class="level4">
<h4 class="anchored" data-anchor-id="checking-balance-of-covariates">Checking Balance of Covariates</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># balance function to calculate normalized distance</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Look through this function in detail what each of the arguments are doing</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>balance <span class="ot">&lt;-</span> <span class="cf">function</span>(x, Tr, xname, <span class="at">alpha=</span><span class="fl">0.05</span>) {</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  Tr <span class="ot">=</span> Tr[<span class="sc">!</span><span class="fu">is.na</span>(x)]</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  x  <span class="ot">=</span>  x[<span class="sc">!</span><span class="fu">is.na</span>(x)]     </span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  mut <span class="ot">=</span> <span class="fu">mean</span>(x[Tr<span class="sc">==</span><span class="dv">1</span>])</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  muc <span class="ot">=</span> <span class="fu">mean</span>(x[Tr<span class="sc">==</span><span class="dv">0</span>])</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  s2t  <span class="ot">=</span> <span class="fu">var</span>(x[Tr<span class="sc">==</span><span class="dv">1</span>])</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  s2c  <span class="ot">=</span> <span class="fu">var</span>(x[Tr<span class="sc">==</span><span class="dv">0</span>])    </span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>  delta <span class="ot">=</span> (mut <span class="sc">-</span> muc)<span class="sc">/</span><span class="fu">sqrt</span>((s2t<span class="sc">+</span>s2c)<span class="sc">/</span><span class="dv">2</span>) <span class="co"># this is the normalized difference</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>  ql <span class="ot">=</span> <span class="fu">quantile</span>(x[Tr<span class="sc">==</span><span class="dv">0</span>], <span class="at">probs =</span> alpha<span class="sc">/</span><span class="dv">2</span>) <span class="co"># lower tail for control</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>  qh <span class="ot">=</span> <span class="fu">quantile</span>(x[Tr<span class="sc">==</span><span class="dv">0</span>], <span class="at">probs =</span> <span class="dv">1</span><span class="sc">-</span>alpha<span class="sc">/</span><span class="dv">2</span>) <span class="co"># upper tail for control</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>  pi <span class="ot">=</span> <span class="fu">sum</span>(x[Tr<span class="sc">==</span><span class="dv">1</span>] <span class="sc">&lt;</span> ql)<span class="sc">/</span>(<span class="fu">length</span>(Tr<span class="sc">==</span><span class="dv">1</span>)) <span class="sc">+</span> <span class="fu">sum</span>(x[Tr<span class="sc">==</span><span class="dv">1</span>] <span class="sc">&gt;</span> qh)<span class="sc">/</span>(<span class="fu">length</span>(Tr<span class="sc">==</span><span class="dv">1</span>)) <span class="co"># fraction</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"------------------------------------------</span><span class="sc">\n</span><span class="st">"</span>)    </span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Variable "</span>, xname, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Mean Treatment (Pres) "</span>, mut, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Mean Control (Parl)"</span>, muc, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Normalized difference"</span>, delta, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)        </span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"------------------------------------------</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Mass of treated distribution in the control tails"</span>, <span class="fu">round</span>(pi<span class="sc">*</span><span class="dv">100</span>, <span class="dv">2</span>), <span class="st">"% </span><span class="sc">\n</span><span class="st">"</span>)    </span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"------------------------------------------</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">mut=</span>mut,<span class="at">muc=</span>muc, <span class="at">s2t=</span>s2t, <span class="at">s2c=</span>s2c, <span class="at">delta=</span>delta, <span class="at">pi=</span>pi))</span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Code</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Result</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="sourceCode" id="cb33"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="in"># (1) Let's look at normalized differences and Mass of Treated Distribution in Control Tailes</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="in"># Also Recall Rubin's rule: if above |0.25|, then OLS likely too sensitive to misspecification</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="in"># create vector for treatment index</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="in">Tr = data$purepres</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="in"># check for balance on treatment</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="in">result &lt;- imap(X, ~ balance(x = .x, Tr = Tr, xname = .y))</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>------------------------------------------
Variable  Violent Independence 
Mean Treatment (Pres)  0.6666667 
Mean Control (Parl) 0.5081967 
Normalized difference 0.3218476 
------------------------------------------
Mass of treated distribution in the control tails 0 % 
------------------------------------------
------------------------------------------
Variable  Year of Independence 
Mean Treatment (Pres)  1872.444 
Mean Control (Parl) 1829.754 
Normalized difference 0.2299536 
------------------------------------------
Mass of treated distribution in the control tails 0 % 
------------------------------------------
------------------------------------------
Variable  Independency by Decolonization 
Mean Treatment (Pres)  0.5925926 
Mean Control (Parl) 0.4754098 
Normalized difference 0.2333725 
------------------------------------------
Mass of treated distribution in the control tails 0 % 
------------------------------------------
------------------------------------------
Variable  Independence by Secession 
Mean Treatment (Pres)  0.3703704 
Mean Control (Parl) 0.2295082 
Normalized difference 0.3066766 
------------------------------------------
Mass of treated distribution in the control tails 0 % 
------------------------------------------
------------------------------------------
Variable  Christian Protestant Pct 
Mean Treatment (Pres)  0.04634815 
Mean Control (Parl) 0.1500733 
Normalized difference -0.5113226 
------------------------------------------
Mass of treated distribution in the control tails 0 % 
------------------------------------------
------------------------------------------
Variable  Christian Catholic Pct 
Mean Treatment (Pres)  0.6333444 
Mean Control (Parl) 0.2700083 
Normalized difference 0.974737 
------------------------------------------
Mass of treated distribution in the control tails 0 % 
------------------------------------------
------------------------------------------
Variable  Jewish Pct 
Mean Treatment (Pres)  0.003403704 
Mean Control (Parl) 0.01728167 
Normalized difference -0.173385 
------------------------------------------
Mass of treated distribution in the control tails 2.3 % 
------------------------------------------
------------------------------------------
Variable  Islam Pct 
Mean Treatment (Pres)  0.08145926 
Mean Control (Parl) 0.15313 
Normalized difference -0.2808659 
------------------------------------------
Mass of treated distribution in the control tails 0 % 
------------------------------------------
------------------------------------------
Variable  Budhist Pct 
Mean Treatment (Pres)  0.006037037 
Mean Control (Parl) 0.046435 
Normalized difference -0.3403212 
------------------------------------------
Mass of treated distribution in the control tails 0 % 
------------------------------------------
------------------------------------------
Variable  Ethic Fractionalization 
Mean Treatment (Pres)  0.4554665 
Mean Control (Parl) 0.3694653 
Normalized difference 0.3641619 
------------------------------------------
Mass of treated distribution in the control tails 3.41 % 
------------------------------------------
------------------------------------------
Variable  Linguistic Fractionalization 
Mean Treatment (Pres)  0.3310051 
Mean Control (Parl) 0.3412398 
Normalized difference -0.03638428 
------------------------------------------
Mass of treated distribution in the control tails 4.6 % 
------------------------------------------
------------------------------------------
Variable  Religious Fractionalization 
Mean Treatment (Pres)  0.3815061 
Mean Control (Parl) 0.4423086 
Normalized difference -0.2694968 
------------------------------------------
Mass of treated distribution in the control tails 2.27 % 
------------------------------------------
------------------------------------------
Variable  Gini 
Mean Treatment (Pres)  49.35769 
Mean Control (Parl) 40.95091 
Normalized difference 0.759161 
------------------------------------------
Mass of treated distribution in the control tails 1.23 % 
------------------------------------------
------------------------------------------
Variable  Land (km) 
Mean Treatment (Pres)  1139389 
Mean Control (Parl) 887566 
Normalized difference 0.1041268 
------------------------------------------
Mass of treated distribution in the control tails 1.14 % 
------------------------------------------
------------------------------------------
Variable  Life expectancy 1800 
Mean Treatment (Pres)  31.2861 
Mean Control (Parl) 33.27707 
Normalized difference -0.5445587 
------------------------------------------
Mass of treated distribution in the control tails 0 % 
------------------------------------------
------------------------------------------
Variable  GDP per cap 1800 
Mean Treatment (Pres)  918.2593 
Mean Control (Parl) 1180.317 
Normalized difference -0.5806425 
------------------------------------------
Mass of treated distribution in the control tails 1.15 % 
------------------------------------------
------------------------------------------
Variable  Population density 
Mean Treatment (Pres)  7.215313 
Mean Control (Parl) 19.77811 
Normalized difference -0.6009871 
------------------------------------------
Mass of treated distribution in the control tails 2.27 % 
------------------------------------------
------------------------------------------
Variable  Country in America 
Mean Treatment (Pres)  0.6666667 
Mean Control (Parl) 0.06557377 
Normalized difference 1.570273 
------------------------------------------
Mass of treated distribution in the control tails 0 % 
------------------------------------------
------------------------------------------
Variable  Country in South America 
Mean Treatment (Pres)  0.3333333 
Mean Control (Parl) 0.01639344 
Normalized difference 0.9015721 
------------------------------------------
Mass of treated distribution in the control tails 10.23 % 
------------------------------------------
------------------------------------------
Variable  Country in Europe 
Mean Treatment (Pres)  0 
Mean Control (Parl) 0.4918033 
Normalized difference -1.379766 
------------------------------------------
Mass of treated distribution in the control tails 0 % 
------------------------------------------
------------------------------------------
Variable  Country in Africa 
Mean Treatment (Pres)  0.1851852 
Mean Control (Parl) 0.147541 
Normalized difference 0.09979829 
------------------------------------------
Mass of treated distribution in the control tails 0 % 
------------------------------------------
------------------------------------------
Variable  Country in Asia 
Mean Treatment (Pres)  0.1481481 
Mean Control (Parl) 0.2295082 
Normalized difference -0.2063768 
------------------------------------------
Mass of treated distribution in the control tails 0 % 
------------------------------------------
------------------------------------------
Variable  Country in Oceania 
Mean Treatment (Pres)  0 
Mean Control (Parl) 0.06557377 
Normalized difference -0.3715509 
------------------------------------------
Mass of treated distribution in the control tails 0 % 
------------------------------------------
------------------------------------------
Variable  Spanish colony 
Mean Treatment (Pres)  0.6666667 
Mean Control (Parl) 0.01818182 
Normalized difference 1.833951 
------------------------------------------
Mass of treated distribution in the control tails 20.25 % 
------------------------------------------
------------------------------------------
Variable  British colony 
Mean Treatment (Pres)  0.2083333 
Mean Control (Parl) 0.3090909 
Normalized difference -0.2282852 
------------------------------------------
Mass of treated distribution in the control tails 0 % 
------------------------------------------
------------------------------------------
Variable  France colony 
Mean Treatment (Pres)  0.04166667 
Mean Control (Parl) 0.05454545 
Normalized difference -0.05934487 
------------------------------------------
Mass of treated distribution in the control tails 0 % 
------------------------------------------
------------------------------------------
Variable  Portugal colony 
Mean Treatment (Pres)  0.04166667 
Mean Control (Parl) 0.01818182 
Normalized difference 0.1357614 
------------------------------------------
Mass of treated distribution in the control tails 1.27 % 
------------------------------------------
------------------------------------------
Variable  OEU colony 
Mean Treatment (Pres)  0.04166667 
Mean Control (Parl) 0.01818182 
Normalized difference 0.1357614 
------------------------------------------
Mass of treated distribution in the control tails 1.27 % 
------------------------------------------
------------------------------------------
Variable  Ruggedness 
Mean Treatment (Pres)  1.204625 
Mean Control (Parl) 1.282836 
Normalized difference -0.08265628 
------------------------------------------
Mass of treated distribution in the control tails 0 % 
------------------------------------------</code></pre>
</div>
</div>
</div>
</div>
</div>
<p><br></p>
<p>The “Mass of treated distribution in the control tails” is a percentage that indicates how much of the treated group’s data lies in the extreme tails of the control group’s distribution. A high value suggests imbalance between the two groups, as it indicates that the treated group has many values in regions of the distribution that are less typical for the control group.</p>
<p><strong>Why Is This Important?</strong></p>
<p>In balance checks meant for attribution of effect to treatment, as done under assumpotion of uncoundedness or selection on observables, we want the treated and control groups to be similar in distribution for all covariates (except for the treatment assignment). When there’s a large portion of the treated group in the tails of the control distribution, it suggests that the two groups are not well balanced for that variable, meaning there may be substantial differences in their distribution. This would raise concerns about whether we can attribute the differences in outcomes to the treatment alone, rather than to the covariates being imbalanced.</p>
</section>
<section id="propensity-score-matching-on-treatment-and-control" class="level3">
<h3 class="anchored" data-anchor-id="propensity-score-matching-on-treatment-and-control">Propensity Score Matching on Treatment and Control</h3>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">Creating Propensity Scores</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Plot of Propensity Scores</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" role="tab" aria-controls="tabset-3-3" aria-selected="false">Ideal Overlap Simulation</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the propensity scores with full data set </span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>pscore<span class="ot">&lt;-</span><span class="fu">glm</span>(Tr<span class="sc">~</span><span class="fu">as.matrix</span>(X),<span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link=</span>logit)) <span class="co"># why the warnings?</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co"># create smaller X vector - taking out variables like continent and colonial history </span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>X2 <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">Violent_Independence =</span> indviol,</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">Year_of_Independence =</span> year_indep,</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">Independency_by_Decolonization =</span> dindep_decol,</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">Independence_by_Secession =</span> dindep_seces,</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">Christian_Protestant_Pct =</span> chrstprotpct,</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">Christian_Catholic_Pct =</span> chrstcatpct,</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">Jewish_Pct =</span> judgenpct,</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">Islam_Pct =</span> islmgenpct,</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">Budhist_Pct =</span> budgenpct,</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">Ethnic_Fractionalization =</span> a_ethnic,</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">Linguistic_Fractionalization =</span> a_ling,</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">Religious_Fractionalization =</span> a_relig,</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>    gini,</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">Land_kilometers =</span> land_kilometers,</span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">Life_expectancy_1800 =</span> life_expectency_1800,</span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">GDP_per_capita_1800 =</span> gdp_per_capita_1800,</span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">Population_density =</span> density,</span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">Country_in_Africa =</span> dafrica,</span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">Country_in_Asia =</span> dasia,</span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">Ruggedness =</span> rugged</span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a><span class="co"># create index for complete observations and select those </span></span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a>indx <span class="ot">=</span> <span class="fu">complete.cases</span>(X2)</span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a><span class="co"># filter our treatment vector on complete cases</span></span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a>Tr2 <span class="ot">=</span> Tr[indx]</span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate propensity score on this subset </span></span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a>pscore<span class="ot">&lt;-</span><span class="fu">glm</span>(Tr2 <span class="sc">~</span> ., <span class="at">data=</span> X2[indx,],<span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link=</span>logit))</span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a><span class="co"># pull out propensity score for graphing</span></span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a>phat<span class="ot">&lt;-</span>pscore<span class="sc">$</span>fitted.values</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># histogram of propensity scores </span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(phat), <span class="fu">aes</span>(<span class="at">x =</span> phat)) <span class="sc">+</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.05</span>, <span class="at">fill =</span> <span class="st">"darkgreen"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histogram of PScores"</span>, </span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Predicted Propensity Scores (phat)"</span>, </span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="matching_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot pscore by treatment</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data)<span class="sc">+</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">data=</span><span class="fu">data.frame</span>(<span class="at">x=</span>phat[Tr2<span class="sc">==</span><span class="dv">1</span>]), <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">fill=</span><span class="st">"Tr"</span>), <span class="at">trim=</span><span class="cn">FALSE</span>, <span class="at">adjust=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">from=</span><span class="dv">0</span>, <span class="at">to=</span><span class="dv">1</span>, <span class="at">alpha=</span><span class="fl">0.2</span>,  <span class="at">bw =</span> <span class="st">"nrd0"</span>, <span class="at">kernel =</span> <span class="st">"gaussian"</span>)<span class="sc">+</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">data=</span><span class="fu">data.frame</span>(<span class="at">x=</span>phat[Tr2<span class="sc">==</span><span class="dv">0</span>]), <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">fill=</span><span class="st">"Co"</span>), <span class="at">trim=</span><span class="cn">FALSE</span>, <span class="at">adjust=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">from=</span><span class="dv">0</span>, <span class="at">to=</span><span class="dv">1</span>, <span class="at">alpha=</span><span class="fl">0.2</span>,  <span class="at">bw =</span> <span class="st">"nrd0"</span>, <span class="at">kernel =</span> <span class="st">"gaussian"</span>)<span class="sc">+</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"Tr"</span><span class="ot">=</span><span class="st">"blue"</span>, <span class="st">"Co"</span><span class="ot">=</span><span class="st">"red"</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Presidential (T = 1) "</span>, <span class="st">"Parliamentary (T = 0)"</span>))<span class="sc">+</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Probability of Being in Treatment"</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">+</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_blank</span>()</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="matching_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-3-tab">
<p>Compare to what the histogram would look under simulated “random assignment” if both groups were identical on average</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate T using runif</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>T0 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">runif</span>(<span class="at">n =</span> <span class="fu">length</span>(Tr2), <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">1</span>) <span class="sc">&gt;=</span> <span class="fl">0.5</span>) <span class="co"># Create T variable</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame combining phat and T</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>data2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">phat =</span> phat, <span class="at">group =</span> <span class="fu">factor</span>(T0, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Parliamentary"</span>, <span class="st">"Presidential"</span>)))</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the density using ggplot2</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data2, <span class="fu">aes</span>(<span class="at">x =</span> phat, <span class="at">fill =</span> group)) <span class="sc">+</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="sc">-</span><span class="fl">0.3</span>, <span class="fl">1.3</span>) <span class="sc">+</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Density of Estimated Propensity Score"</span>, </span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Predicted Propensity Score (phat)"</span>, </span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Density"</span>) <span class="sc">+</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>)) <span class="sc">+</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"topright"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="matching_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The simulation shows ideal random assignment.<br>
Comparing this to actual plots from propensity scores reveals the problem.</p>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="taking-a-different-smaller-set-of-covariates" class="level3">
<h3 class="anchored" data-anchor-id="taking-a-different-smaller-set-of-covariates">Taking a different (smaller) set of covariates</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Now include fewer variables to avoid perfect separation</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>X2 <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(indviol, year_indep, dindep_decol, dindep_seces,</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>           a_ethnic, a_ling, a_relig,</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>           life_expectency_1800, gdp_per_capita_1800,</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>           damerica, dsouthamerica, deurope, dafrica,</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>         dasia, doceania)</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(X2) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Violent Independenc"</span>, <span class="st">"Year of Independence"</span>, <span class="st">"Independency by Decolonization"</span>, <span class="st">"Independence by Secession"</span>,</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"Ethic Fractionalization"</span>, <span class="st">"Linguistic Fractionalization"</span>, <span class="st">"Religious Fractionalization"</span>,</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"Life expectancy 1800"</span>, <span class="st">"GDP per cap 1800"</span>,</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"Country in America"</span>, <span class="st">"Country in South America"</span>, <span class="st">"Country in Europe"</span>, <span class="st">"Country in Africa"</span>, <span class="st">"Country in Asia"</span>, <span class="st">"Country in Oceania"</span>)</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a><span class="co"># index on complete cases</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>indx <span class="ot">=</span> <span class="fu">complete.cases</span>(X2)</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="co"># index treatment vector on complete cases</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>Tr2 <span class="ot">=</span> Tr[indx]</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate propensity score</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>pscore<span class="ot">&lt;-</span><span class="fu">glm</span>(Tr2<span class="sc">~</span> . , <span class="at">data =</span> X2[indx,],<span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link=</span>logit)) </span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>phat<span class="ot">&lt;-</span>pscore<span class="sc">$</span>fitted.values</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(phat), <span class="fu">aes</span>(<span class="at">x =</span> phat)) <span class="sc">+</span></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.05</span>, <span class="at">fill =</span> <span class="st">"pink"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histogram of PScores"</span>, </span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Predicted Propensity Scores (phat)"</span>, </span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="matching_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Comparing again</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame combining phat and Tr2</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>data3 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">phat =</span> phat, <span class="at">Tr2 =</span> <span class="fu">factor</span>(Tr2, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Parliamentary (Co)"</span>, <span class="st">"Presidential (Tr)"</span>)))</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up the plot layout</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co"># First plot: density plots</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data3, <span class="fu">aes</span>(<span class="at">x =</span> phat, <span class="at">fill =</span> Tr2)) <span class="sc">+</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">position =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>)) <span class="sc">+</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Density of Predicted Propensity Scores"</span>, </span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Predicted Propensity Score (phat)"</span>, </span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Density"</span>) <span class="sc">+</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Second plot: boxplot</span></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data3, <span class="fu">aes</span>(<span class="at">x =</span> Tr2, <span class="at">y =</span> phat)) <span class="sc">+</span></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">outlier.shape =</span> <span class="cn">NA</span>) <span class="sc">+</span> <span class="co"># Suppressing outlier shapes for clarity</span></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.2</span>, <span class="fu">aes</span>(<span class="at">color =</span> Tr2), <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span> <span class="co"># Adding jitter for visibility</span></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Boxplot of Predicted Propensity Scores by Group"</span>, </span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Group"</span>, </span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Predicted Propensity Score (phat)"</span>) <span class="sc">+</span></span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>)) <span class="sc">+</span></span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span></span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the two plots using gridExtra</span></span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="matching_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># These are all different ways to see balance on propensity scores</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="propesnity-score-density" class="level3">
<h3 class="anchored" data-anchor-id="propesnity-score-density">Propesnity Score Density</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pscore Density plots</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">phat =</span> <span class="fu">c</span>(phat[Tr2<span class="sc">==</span><span class="dv">1</span>], phat[Tr2<span class="sc">==</span><span class="dv">0</span>]), <span class="at">Tr=</span>Tr2, <span class="at">groups =</span> <span class="fu">as.character</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"Tr"</span>, <span class="fu">length</span>(Tr2<span class="sc">==</span><span class="dv">1</span>)), <span class="fu">rep</span>(<span class="st">"Co"</span>, <span class="fu">length</span>(Tr2<span class="sc">==</span><span class="dv">0</span>)))))</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat)<span class="sc">+</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">data=</span><span class="fu">data.frame</span>(<span class="at">x=</span>phat[Tr2<span class="sc">==</span><span class="dv">1</span>]), <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">fill=</span><span class="st">"Tr"</span>), <span class="at">trim=</span><span class="cn">FALSE</span>, <span class="at">adjust=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">from=</span><span class="dv">0</span>, <span class="at">to=</span><span class="dv">1</span>, <span class="at">alpha=</span><span class="fl">0.2</span>,  <span class="at">bw =</span> <span class="st">"nrd0"</span>, <span class="at">kernel =</span> <span class="st">"gaussian"</span>) <span class="sc">+</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">data=</span><span class="fu">data.frame</span>(<span class="at">x=</span>phat[Tr2<span class="sc">==</span><span class="dv">0</span>]), <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">fill=</span><span class="st">"Co"</span>), <span class="at">trim=</span><span class="cn">FALSE</span>, <span class="at">adjust=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">from=</span><span class="dv">0</span>, <span class="at">to=</span><span class="dv">1</span>, <span class="at">alpha=</span><span class="fl">0.2</span>,  <span class="at">bw =</span> <span class="st">"nrd0"</span>, <span class="at">kernel =</span> <span class="st">"gaussian"</span>) <span class="sc">+</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"Tr"</span><span class="ot">=</span><span class="st">"red"</span>, <span class="st">"Co"</span><span class="ot">=</span><span class="st">"blue"</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Presidential (T = 1) "</span>, <span class="st">"Parliamentary (T = 0)"</span>))<span class="sc">+</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Probability of Being in Treatment"</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">+</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_blank</span>()</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="matching_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># balance in propensity score</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">balance</span>(<span class="at">x=</span>phat, <span class="at">Tr=</span> Tr2, <span class="at">xname=</span><span class="st">"phat"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>------------------------------------------
Variable  phat 
Mean Treatment (Pres)  0.6811678 
Mean Control (Parl) 0.1381606 
Normalized difference 2.205072 
------------------------------------------
Mass of treated distribution in the control tails 19.77 % 
------------------------------------------</code></pre>
</div>
</div>
<p>As you can see, it is still quite unbalanced.</p>
</section>
</section>
<section id="how-to-use-matching" class="level2">
<h2 class="anchored" data-anchor-id="how-to-use-matching">How to Use Matching</h2>
<section id="match-on-covariates" class="level3">
<h3 class="anchored" data-anchor-id="match-on-covariates">Match on Covariates</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set up </span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("Matching")</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Matching)</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="co"># match on covariates</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>mout1 <span class="ot">&lt;-</span> <span class="fu">Match</span>(<span class="at">Tr=</span>Tr[indx], <span class="at">X =</span> X2[indx,], <span class="at">estimand=</span><span class="st">"ATT"</span>, <span class="at">ties=</span><span class="cn">FALSE</span>)</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mout1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Estimate...  0 
SE.........  0 
T-stat.....  NaN 
p.val......  NA 

Original number of observations..............  86 
Original number of treated obs...............  26 
Matched number of observations...............  26 
Matched number of observations  (unweighted).  26 </code></pre>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">Running MatchBalance()</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">Output</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="sourceCode" id="cb47"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="in">MatchBalance(Tr[indx] ~ ., data = X2[indx,], match.out=mout1)</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="in"># What does the output mean?</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="in"># Let's look at the documentation of ?MatchBalance</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="in"># Let's look at the results again</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="in"># See what rows of value for covariates change</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
***** (V1) `Violent Independenc` *****
                       Before Matching       After Matching
mean treatment........    0.65385           0.65385 
mean control..........        0.5           0.69231 
std mean diff.........      31.71           -7.9275 

mean raw eQQ diff.....    0.15385          0.038462 
med  raw eQQ diff.....          0                 0 
max  raw eQQ diff.....          1                 1 

mean eCDF diff........   0.076923          0.019231 
med  eCDF diff........   0.076923          0.019231 
max  eCDF diff........    0.15385          0.038462 

var ratio (Tr/Co).....    0.92585            1.0625 
T-test p-value........    0.18817           0.65734 


***** (V2) `Year of Independence` *****
                       Before Matching       After Matching
mean treatment........     1873.7            1873.7 
mean control..........     1833.8            1900.4 
std mean diff.........     61.639           -41.192 

mean raw eQQ diff.....     130.81            27.077 
med  raw eQQ diff.....       63.5                 6 
max  raw eQQ diff.....        840                82 

mean eCDF diff........    0.16815           0.10743 
med  eCDF diff........    0.15769          0.076923 
max  eCDF diff........    0.36538           0.30769 

var ratio (Tr/Co).....   0.064641            1.1792 
T-test p-value........    0.26113          0.030679 
KS Bootstrap p-value..      0.014             0.126 
KS Naive p-value......  0.0091303           0.13814 
KS Statistic..........    0.36538           0.30769 


***** (V3) `Independency by Decolonization` *****
                       Before Matching       After Matching
mean treatment........    0.61538           0.61538 
mean control..........    0.48333           0.73077 
std mean diff.........     26.616           -23.257 

mean raw eQQ diff.....    0.15385           0.11538 
med  raw eQQ diff.....          0                 0 
max  raw eQQ diff.....          1                 1 

mean eCDF diff........   0.066026          0.057692 
med  eCDF diff........   0.066026          0.057692 
max  eCDF diff........    0.13205           0.11538 

var ratio (Tr/Co).....    0.96928             1.203 
T-test p-value........    0.26482          0.077437 


***** (V4) `Independence by Secession` *****
                       Before Matching       After Matching
mean treatment........    0.34615           0.34615 
mean control..........    0.23333           0.26923 
std mean diff.........     23.254            15.855 

mean raw eQQ diff.....    0.11538          0.076923 
med  raw eQQ diff.....          0                 0 
max  raw eQQ diff.....          1                 1 

mean eCDF diff........    0.05641          0.038462 
med  eCDF diff........    0.05641          0.038462 
max  eCDF diff........    0.11282          0.076923 

var ratio (Tr/Co).....     1.2939            1.1504 
T-test p-value........    0.31057           0.31759 


***** (V5) `Ethic Fractionalization` *****
                       Before Matching       After Matching
mean treatment........    0.46538           0.46538 
mean control..........    0.37542           0.48415 
std mean diff.........     37.869           -7.9049 

mean raw eQQ diff.....    0.10566          0.066566 
med  raw eQQ diff.....   0.099907          0.061492 
max  raw eQQ diff.....       0.21           0.14438 

mean eCDF diff........    0.11999          0.077963 
med  eCDF diff........    0.10769          0.076923 
max  eCDF diff........    0.28718           0.23077 

var ratio (Tr/Co).....     1.0573            1.0826 
T-test p-value........    0.11067           0.69009 
KS Bootstrap p-value..      0.064             0.418 
KS Naive p-value......   0.079403           0.46218 
KS Statistic..........    0.28718           0.23077 


***** (V6) `Linguistic Fractionalization` *****
                       Before Matching       After Matching
mean treatment........    0.33101           0.33101 
mean control..........    0.34663           0.40658 
std mean diff.........    -5.0586           -24.468 

mean raw eQQ diff.....   0.070562          0.099725 
med  raw eQQ diff.....   0.070461          0.059251 
max  raw eQQ diff.....    0.18848           0.28053 

mean eCDF diff........   0.081112           0.11435 
med  eCDF diff........   0.080769          0.076923 
max  eCDF diff........    0.20128           0.34615 

var ratio (Tr/Co).....     1.5366            1.3935 
T-test p-value........    0.82096          0.030313 
KS Bootstrap p-value..      0.356             0.056 
KS Naive p-value......    0.39378          0.065032 
KS Statistic..........    0.20128           0.34615 


***** (V7) `Religious Fractionalization` *****
                       Before Matching       After Matching
mean treatment........    0.38249           0.38249 
mean control..........    0.44067           0.34795 
std mean diff.........    -25.495            15.139 

mean raw eQQ diff.....   0.080581          0.055022 
med  raw eQQ diff.....   0.072014           0.04163 
max  raw eQQ diff.....    0.20034           0.16627 

mean eCDF diff........   0.092695           0.11331 
med  eCDF diff........   0.064103          0.076923 
max  eCDF diff........    0.29744           0.38462 

var ratio (Tr/Co).....    0.99339            0.8127 
T-test p-value........    0.28348           0.39388 
KS Bootstrap p-value..      0.056             0.038 
KS Naive p-value......   0.063197          0.035888 
KS Statistic..........    0.29744           0.38462 


***** (V8) `Life expectancy 1800` *****
                       Before Matching       After Matching
mean treatment........     31.386            31.386 
mean control..........     33.225            32.671 
std mean diff.........    -53.291           -37.245 

mean raw eQQ diff.....     1.7649            1.8473 
med  raw eQQ diff.....       1.83              2.05 
max  raw eQQ diff.....        3.4              3.51 

mean eCDF diff........    0.14984           0.15012 
med  eCDF diff........    0.12821          0.076923 
max  eCDF diff........    0.38462           0.46154 

var ratio (Tr/Co).....    0.78917           0.87149 
T-test p-value........   0.033452          0.051485 
KS Bootstrap p-value..      0.004        &lt; 2.22e-16 
KS Naive p-value......  0.0053601         0.0056297 
KS Statistic..........    0.38462           0.46154 


***** (V9) `GDP per cap 1800` *****
                       Before Matching       After Matching
mean treatment........     914.12            914.12 
mean control..........     1180.3            1009.1 
std mean diff.........    -81.331           -29.025 

mean raw eQQ diff.....     286.88            130.38 
med  raw eQQ diff.....        193               113 
max  raw eQQ diff.....        796               452 

mean eCDF diff........    0.14666            0.1237 
med  eCDF diff........   0.094872           0.11538 
max  eCDF diff........    0.40128           0.34615 

var ratio (Tr/Co).....     0.3525            1.5045 
T-test p-value........  0.0069009           0.14223 
KS Bootstrap p-value..      0.002             0.058 
KS Naive p-value......  0.0038375          0.068177 
KS Statistic..........    0.40128           0.34615 


***** (V10) `Country in America` *****
                       Before Matching       After Matching
mean treatment........    0.65385           0.65385 
mean control..........   0.066667           0.42308 
std mean diff.........     121.03            47.565 

mean raw eQQ diff.....    0.57692           0.23077 
med  raw eQQ diff.....          1                 0 
max  raw eQQ diff.....          1                 1 

mean eCDF diff........    0.29359           0.11538 
med  eCDF diff........    0.29359           0.11538 
max  eCDF diff........    0.58718           0.23077 

var ratio (Tr/Co).....     3.7199           0.92727 
T-test p-value........ 1.9372e-06          0.009874 


***** (V11) `Country in South America` *****
                       Before Matching       After Matching
mean treatment........    0.34615           0.34615 
mean control..........   0.016667           0.34615 
std mean diff.........     67.912                 0 

mean raw eQQ diff.....    0.30769                 0 
med  raw eQQ diff.....          0                 0 
max  raw eQQ diff.....          1                 0 

mean eCDF diff........    0.16474                 0 
med  eCDF diff........    0.16474                 0 
max  eCDF diff........    0.32949                 0 

var ratio (Tr/Co).....     14.123                 1 
T-test p-value........  0.0020845                 1 


***** (V12) `Country in Europe` *****
                       Before Matching       After Matching
mean treatment........          0                 0 
mean control..........        0.5          0.076923 
std mean diff.........       -Inf              -Inf 

mean raw eQQ diff.....        0.5          0.076923 
med  raw eQQ diff.....        0.5                 0 
max  raw eQQ diff.....          1                 1 

mean eCDF diff........       0.25          0.038462 
med  eCDF diff........       0.25          0.038462 
max  eCDF diff........        0.5          0.076923 

var ratio (Tr/Co).....          0                 0 
T-test p-value........ 1.8965e-10           0.15351 


***** (V13) `Country in Africa` *****
                       Before Matching       After Matching
mean treatment........    0.19231           0.19231 
mean control..........       0.15           0.19231 
std mean diff.........     10.526                 0 

mean raw eQQ diff.....   0.038462                 0 
med  raw eQQ diff.....          0                 0 
max  raw eQQ diff.....          1                 0 

mean eCDF diff........   0.021154                 0 
med  eCDF diff........   0.021154                 0 
max  eCDF diff........   0.042308                 0 

var ratio (Tr/Co).....     1.2459                 1 
T-test p-value........    0.64616                 1 


***** (V14) `Country in Asia` *****
                       Before Matching       After Matching
mean treatment........    0.15385           0.15385 
mean control..........    0.21667           0.30769 
std mean diff.........    -17.073           -41.812 

mean raw eQQ diff.....   0.076923           0.15385 
med  raw eQQ diff.....          0                 0 
max  raw eQQ diff.....          1                 1 

mean eCDF diff........    0.03141          0.076923 
med  eCDF diff........    0.03141          0.076923 
max  eCDF diff........   0.062821           0.15385 

var ratio (Tr/Co).....    0.78439           0.61111 
T-test p-value........    0.48777           0.03936 


***** (V15) `Country in Oceania` *****
                       Before Matching       After Matching
mean treatment........          0                 0 
mean control..........   0.066667                 0 
std mean diff.........       -Inf                 0 

mean raw eQQ diff.....   0.076923                 0 
med  raw eQQ diff.....          0                 0 
max  raw eQQ diff.....          1                 0 

mean eCDF diff........   0.033333                 0 
med  eCDF diff........   0.033333                 0 
max  eCDF diff........   0.066667                 0 

var ratio (Tr/Co).....          0               NaN 
T-test p-value........   0.044528                 1 


Before Matching Minimum p.value: 1.8965e-10 
Variable Name(s): `Country in Europe`  Number(s): 12 

After Matching Minimum p.value: &lt; 2.22e-16 
Variable Name(s): `Life expectancy 1800`  Number(s): 8 </code></pre>
</div>
</div>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="match-on-propensity-scores" class="level3">
<h3 class="anchored" data-anchor-id="match-on-propensity-scores">Match on Propensity Scores</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># match on propensity score</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>mout2 <span class="ot">&lt;-</span> <span class="fu">Match</span>(<span class="at">Tr=</span>Tr[indx], <span class="at">X=</span>phat, <span class="at">estimand=</span><span class="st">"ATT"</span>, <span class="at">ties=</span><span class="cn">FALSE</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mout2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Estimate...  0 
SE.........  0 
T-stat.....  NaN 
p.val......  NA 

Original number of observations..............  86 
Original number of treated obs...............  26 
Matched number of observations...............  26 
Matched number of observations  (unweighted).  26 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">MatchBalance</span>(Tr[indx] <span class="sc">~</span> phat, <span class="at">match.out=</span>mout2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
***** (V1) phat *****
                       Before Matching       After Matching
mean treatment........    0.68117           0.68117 
mean control..........    0.13816           0.67938 
std mean diff.........     196.78           0.64781 

mean raw eQQ diff.....     0.5399          0.045756 
med  raw eQQ diff.....    0.54148          0.036657 
max  raw eQQ diff.....    0.84298            0.1225 

mean eCDF diff........    0.41987          0.090498 
med  eCDF diff........    0.48333          0.038462 
max  eCDF diff........    0.71154           0.34615 

var ratio (Tr/Co).....     1.6869           0.97716 
T-test p-value........ 6.1436e-11           0.87615 
KS Bootstrap p-value.. &lt; 2.22e-16             0.058 
KS Naive p-value...... 2.0099e-09           0.07132 
KS Statistic..........    0.71154           0.34615 </code></pre>
</div>
</div>
</section>
<section id="explore-the-matches" class="level3">
<h3 class="anchored" data-anchor-id="explore-the-matches">Explore the matches</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="do">## examine matches </span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>mdataTr <span class="ot">=</span> data[indx,][mout2<span class="sc">$</span>index.treated,]</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>mdataCo <span class="ot">=</span> data[indx,][mout2<span class="sc">$</span>index.control,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceCode" id="cb54"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="in">View(data.frame(mdataTr$country, mdataCo$country))</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Note how Peru appears as the chosen control country for every Latin American country</strong></p>
<div class="cell">
<div class="cell-output-display">
<div style="font-size: 10px;">
<div class="datatables html-widget html-fill-item" id="htmlwidget-9d8f7ad7a7b3e04c4d2d" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-9d8f7ad7a7b3e04c4d2d">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26"],["ARGENTINA","BENIN","BOLIVIA","BRAZIL","CHILE","COLOMBIA","COSTA RICA","CYPRUS","DOMINICAN REPUBLIC","ECUADOR","GAMBIA","GHANA","GUATEMALA","HONDURAS","INDONESIA","KOREA SOUTH","MALAWI","MEXICO","NICARAGUA","PANAMA","PARAGUAY","PHILIPPINES","UNITED STATES","URUGUAY","VENEZUELA","ZAMBIA"],["PERU","ISRAEL","PERU","PERU","PERU","PERU","PERU","ISRAEL","PERU","MOZAMBIQUE","ISRAEL","BANGLADESH","PERU","PERU","PAKISTAN","TAIWAN","SOUTH AFRICA","PERU","PERU","PERU","PERU","SENEGAL","MOZAMBIQUE","PERU","PERU","SOUTH AFRICA"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>mdataTr.country<\/th>\n      <th>mdataCo.country<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":50,"scrollX":true,"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"mdataTr.country","targets":1},{"name":"mdataCo.country","targets":2}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<p>That is because Peru is coded as not being pure presidential.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>purepres[data<span class="sc">$</span>country<span class="sc">==</span><span class="st">"PERU"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>presparlpm[data<span class="sc">$</span>country<span class="sc">==</span><span class="st">"PERU"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
<p><strong>Including Mixed Systems</strong></p>
<p>However, Peru is a variation of presidential system, so it may not be adequate to classify as control.</p>
<p>Let’s code mixed systems as treated.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>Tr <span class="ot">=</span> (data<span class="sc">$</span>purepres <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span> data<span class="sc">$</span>presparlpm<span class="sc">==</span><span class="dv">1</span>)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>mout4 <span class="ot">&lt;-</span> <span class="fu">Match</span>(<span class="at">Tr=</span>Tr[indx], <span class="at">X=</span>X2[indx,], <span class="at">estimand=</span><span class="st">"ATT"</span>)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mout4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Estimate...  0 
SE.........  0 
T-stat.....  NaN 
p.val......  NA 

Original number of observations..............  86 
Original number of treated obs...............  30 
Matched number of observations...............  30 
Matched number of observations  (unweighted).  30 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>mdataTr <span class="ot">=</span> data[indx,][mout4<span class="sc">$</span>index.treated,]</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>mdataCo <span class="ot">=</span> data[indx,][mout4<span class="sc">$</span>index.control,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceCode" id="cb62"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="in">View(data.frame(mdataTr$country, mdataCo$country))</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell">
<div class="cell-output-display">
<div style="font-size: 10px;">
<div class="datatables html-widget html-fill-item" id="htmlwidget-607d1274dbc8af313ef4" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-607d1274dbc8af313ef4">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30"],["ARGENTINA","BENIN","BOLIVIA","BRAZIL","CHILE","COLOMBIA","COSTA RICA","CYPRUS","DOMINICAN REPUBLIC","ECUADOR","GAMBIA","GHANA","GUATEMALA","HONDURAS","INDONESIA","KOREA SOUTH","MALAWI","MEXICO","NAMIBIA","NICARAGUA","PANAMA","PARAGUAY","PERU","PHILIPPINES","SENEGAL","UKRAINE","UNITED STATES","URUGUAY","VENEZUELA","ZAMBIA"],["JAMAICA","SOUTH AFRICA","TRINIDAD AND TOBAGO","TRINIDAD AND TOBAGO","JAMAICA","JAMAICA","POLAND","ISRAEL","MONGOLIA","JAMAICA","MALI","MAURITIUS","TAIWAN","POLAND","ISRAEL","BANGLADESH","SOUTH AFRICA","JAMAICA","MOZAMBIQUE","BANGLADESH","MONGOLIA","FINLAND","CANADA","INDIA","MALI","MACEDONIA","JAMAICA","POLAND","ARMENIA","SOUTH AFRICA"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>mdataTr.country<\/th>\n      <th>mdataCo.country<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":50,"scrollX":true,"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"mdataTr.country","targets":1},{"name":"mdataCo.country","targets":2}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">MatchBalance Code</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false">MatchBalance Output</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div class="sourceCode" id="cb63"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="in">MatchBalance(Tr[indx] ~ ., data =  X2[indx,], match.out=mout4, nboots=10)</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
***** (V1) `Violent Independenc` *****
                       Before Matching       After Matching
mean treatment........    0.63333           0.63333 
mean control..........        0.5               0.4 
std mean diff.........     27.204            47.606 

mean raw eQQ diff.....    0.13333           0.23333 
med  raw eQQ diff.....          0                 0 
max  raw eQQ diff.....          1                 1 

mean eCDF diff........   0.066667           0.11667 
med  eCDF diff........   0.066667           0.11667 
max  eCDF diff........    0.13333           0.23333 

var ratio (Tr/Co).....    0.94376           0.96759 
T-test p-value........    0.23865         0.0052095 


***** (V2) `Year of Independence` *****
                       Before Matching       After Matching
mean treatment........     1882.7            1882.7 
mean control..........     1826.1            1946.2 
std mean diff.........     81.576           -91.426 

mean raw eQQ diff.....     134.53            63.467 
med  raw eQQ diff.....         53              92.5 
max  raw eQQ diff.....        840               122 

mean eCDF diff........    0.13314           0.24902 
med  eCDF diff........    0.11667              0.25 
max  eCDF diff........    0.31667           0.56667 

var ratio (Tr/Co).....   0.070412             5.908 
T-test p-value........    0.13242        3.9478e-05 
KS Bootstrap p-value..        0.1        &lt; 2.22e-16 
KS Naive p-value......   0.023689        5.8786e-05 
KS Statistic..........    0.31667           0.56667 


***** (V3) `Independency by Decolonization` *****
                       Before Matching       After Matching
mean treatment........    0.63333           0.63333 
mean control..........    0.46429           0.66667 
std mean diff.........      34.49           -6.8009 

mean raw eQQ diff.....    0.16667          0.033333 
med  raw eQQ diff.....          0                 0 
max  raw eQQ diff.....          1                 1 

mean eCDF diff........   0.084524          0.016667 
med  eCDF diff........   0.084524          0.016667 
max  eCDF diff........    0.16905          0.033333 

var ratio (Tr/Co).....     0.9486             1.045 
T-test p-value........    0.13617           0.31752 


***** (V4) `Independence by Secession` *****
                       Before Matching       After Matching
mean treatment........    0.33333           0.33333 
mean control..........    0.23214           0.33333 
std mean diff.........     21.105                 0 

mean raw eQQ diff.....        0.1                 0 
med  raw eQQ diff.....          0                 0 
max  raw eQQ diff.....          1                 0 

mean eCDF diff........   0.050595                 0 
med  eCDF diff........   0.050595                 0 
max  eCDF diff........    0.10119                 0 

var ratio (Tr/Co).....     1.2666                 1 
T-test p-value........    0.33686                 1 


***** (V5) `Ethic Fractionalization` *****
                       Before Matching       After Matching
mean treatment........    0.48523           0.48523 
mean control..........    0.35836           0.42003 
std mean diff.........     55.492            28.518 

mean raw eQQ diff.....     0.1415          0.076679 
med  raw eQQ diff.....    0.12276          0.072789 
max  raw eQQ diff.....     0.2612            0.1832 

mean eCDF diff........    0.16375           0.10725 
med  eCDF diff........    0.15714          0.066667 
max  eCDF diff........    0.37857           0.33333 

var ratio (Tr/Co).....    0.99957            1.0037 
T-test p-value........   0.017142          0.044288 
KS Bootstrap p-value.. &lt; 2.22e-16               0.1 
KS Naive p-value......  0.0050673          0.058602 
KS Statistic..........    0.37857           0.33333 


***** (V6) `Linguistic Fractionalization` *****
                       Before Matching       After Matching
mean treatment........    0.36042           0.36042 
mean control..........    0.33199            0.3762 
std mean diff.........      9.407           -5.2182 

mean raw eQQ diff.....   0.052711            0.0509 
med  raw eQQ diff.....   0.023094          0.045404 
max  raw eQQ diff.....    0.18848           0.11195 

mean eCDF diff........   0.055482          0.073913 
med  eCDF diff........   0.039881          0.066667 
max  eCDF diff........    0.20833           0.23333 

var ratio (Tr/Co).....     1.4833           0.94082 
T-test p-value........    0.66065             0.568 
KS Bootstrap p-value..        0.4               0.2 
KS Naive p-value......    0.31127           0.37798 
KS Statistic..........    0.20833           0.23333 


***** (V7) `Religious Fractionalization` *****
                       Before Matching       After Matching
mean treatment........    0.38572           0.38572 
mean control..........     0.4431            0.4778 
std mean diff.........    -25.044           -40.192 

mean raw eQQ diff.....   0.074969          0.098234 
med  raw eQQ diff.....   0.053677          0.065211 
max  raw eQQ diff.....    0.17146            0.2822 

mean eCDF diff........   0.089106            0.1029 
med  eCDF diff........     0.0625               0.1 
max  eCDF diff........    0.27381               0.3 

var ratio (Tr/Co).....     1.0062           0.78179 
T-test p-value........    0.27231          0.062384 
KS Bootstrap p-value..        0.1        &lt; 2.22e-16 
KS Naive p-value......   0.085347           0.12971 
KS Statistic..........    0.27381               0.3 


***** (V8) `Life expectancy 1800` *****
                       Before Matching       After Matching
mean treatment........     31.531            31.531 
mean control..........     33.279              32.3 
std mean diff.........    -48.136           -21.188 

mean raw eQQ diff.....     1.6086            1.0179 
med  raw eQQ diff.....     1.6776              1.15 
max  raw eQQ diff.....        3.1                 2 

mean eCDF diff........    0.13347          0.097436 
med  eCDF diff........    0.11071          0.066667 
max  eCDF diff........    0.33571           0.33333 

var ratio (Tr/Co).....    0.89741           0.98357 
T-test p-value........   0.041052           0.15781 
KS Bootstrap p-value..        0.1               0.2 
KS Naive p-value......   0.016592          0.055924 
KS Statistic..........    0.33571           0.33333 


***** (V9) `GDP per cap 1800` *****
                       Before Matching       After Matching
mean treatment........     884.67            884.67 
mean control..........     1215.1            1141.5 
std mean diff.........    -103.91           -80.776 

mean raw eQQ diff.....      327.8               287 
med  raw eQQ diff.....      269.5               272 
max  raw eQQ diff.....        796               622 

mean eCDF diff........    0.17895           0.23188 
med  eCDF diff........    0.12738           0.23333 
max  eCDF diff........    0.45357           0.53333 

var ratio (Tr/Co).....    0.33049           0.73895 
T-test p-value........ 0.00071184        0.00027375 
KS Bootstrap p-value.. &lt; 2.22e-16        &lt; 2.22e-16 
KS Naive p-value...... 0.00035765        0.00027349 
KS Statistic..........    0.45357           0.53333 


***** (V10) `Country in America` *****
                       Before Matching       After Matching
mean treatment........        0.6               0.6 
mean control..........   0.053571               0.3 
std mean diff.........     109.66            60.208 

mean raw eQQ diff.....    0.53333               0.3 
med  raw eQQ diff.....          1                 0 
max  raw eQQ diff.....          1                 1 

mean eCDF diff........    0.27321              0.15 
med  eCDF diff........    0.27321              0.15 
max  eCDF diff........    0.54643               0.3 

var ratio (Tr/Co).....     4.8094            1.1429 
T-test p-value........ 1.8303e-06         0.0012161 


***** (V11) `Country in South America` *****
                       Before Matching       After Matching
mean treatment........    0.33333           0.33333 
mean control..........          0                 0 
std mean diff.........     69.522            69.522 

mean raw eQQ diff.....    0.33333           0.33333 
med  raw eQQ diff.....          0                 0 
max  raw eQQ diff.....          1                 1 

mean eCDF diff........    0.16667           0.16667 
med  eCDF diff........    0.16667           0.16667 
max  eCDF diff........    0.33333           0.33333 

var ratio (Tr/Co).....        Inf               Inf 
T-test p-value........ 0.00067228         0.0005642 


***** (V12) `Country in Europe` *****
                       Before Matching       After Matching
mean treatment........   0.033333          0.033333 
mean control..........    0.51786           0.16667 
std mean diff.........    -265.38            -73.03 

mean raw eQQ diff.....    0.46667           0.13333 
med  raw eQQ diff.....          0                 0 
max  raw eQQ diff.....          1                 1 

mean eCDF diff........    0.24226          0.066667 
med  eCDF diff........    0.24226          0.066667 
max  eCDF diff........    0.48452           0.13333 

var ratio (Tr/Co).....    0.13112             0.232 
T-test p-value........ 9.3222e-09          0.040171 


***** (V13) `Country in Africa` *****
                       Before Matching       After Matching
mean treatment........    0.23333           0.23333 
mean control..........      0.125           0.23333 
std mean diff.........     25.183                 0 

mean raw eQQ diff.....        0.1                 0 
med  raw eQQ diff.....          0                 0 
max  raw eQQ diff.....          1                 0 

mean eCDF diff........   0.054167                 0 
med  eCDF diff........   0.054167                 0 
max  eCDF diff........    0.10833                 0 

var ratio (Tr/Co).....     1.6617                 1 
T-test p-value........    0.23622                 1 


***** (V14) `Country in Asia` *****
                       Before Matching       After Matching
mean treatment........    0.13333           0.13333 
mean control..........    0.23214               0.3 
std mean diff.........    -28.579           -48.205 

mean raw eQQ diff.....        0.1           0.16667 
med  raw eQQ diff.....          0                 0 
max  raw eQQ diff.....          1                 1 

mean eCDF diff........   0.049405          0.083333 
med  eCDF diff........   0.049405          0.083333 
max  eCDF diff........    0.09881           0.16667 

var ratio (Tr/Co).....    0.65865           0.55026 
T-test p-value........    0.24898          0.020583 


***** (V15) `Country in Oceania` *****
                       Before Matching       After Matching
mean treatment........          0                 0 
mean control..........   0.071429                 0 
std mean diff.........       -Inf                 0 

mean raw eQQ diff.....   0.066667                 0 
med  raw eQQ diff.....          0                 0 
max  raw eQQ diff.....          1                 0 

mean eCDF diff........   0.035714                 0 
med  eCDF diff........   0.035714                 0 
max  eCDF diff........   0.071429                 0 

var ratio (Tr/Co).....          0               NaN 
T-test p-value........   0.044453                 1 


Before Matching Minimum p.value: &lt; 2.22e-16 
Variable Name(s): `Ethic Fractionalization` `GDP per cap 1800`  Number(s): 5 9 

After Matching Minimum p.value: &lt; 2.22e-16 
Variable Name(s): `Year of Independence` `Religious Fractionalization` `GDP per cap 1800`  Number(s): 2 7 9 </code></pre>
</div>
</div>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="incorporating-region-wise-exact-matching" class="level3">
<h3 class="anchored" data-anchor-id="incorporating-region-wise-exact-matching">Incorporating region wise exact matching</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Now do exact matching</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(X2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Violent Independenc"            "Year of Independence"          
 [3] "Independency by Decolonization" "Independence by Secession"     
 [5] "Ethic Fractionalization"        "Linguistic Fractionalization"  
 [7] "Religious Fractionalization"    "Life expectancy 1800"          
 [9] "GDP per cap 1800"               "Country in America"            
[11] "Country in South America"       "Country in Europe"             
[13] "Country in Africa"              "Country in Asia"               
[15] "Country in Oceania"            </code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>exactX <span class="ot">=</span> <span class="fu">rep</span>(<span class="cn">FALSE</span>, <span class="fu">ncol</span>(X2))</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(X2)[<span class="fu">c</span>(<span class="dv">10</span><span class="sc">:</span><span class="dv">15</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Country in America"       "Country in South America"
[3] "Country in Europe"        "Country in Africa"       
[5] "Country in Asia"          "Country in Oceania"      </code></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>exactX[<span class="fu">c</span>(<span class="dv">10</span><span class="sc">:</span><span class="dv">15</span>)] <span class="ot">=</span> <span class="cn">TRUE</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(X2)[exactX]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Country in America"       "Country in South America"
[3] "Country in Europe"        "Country in Africa"       
[5] "Country in Asia"          "Country in Oceania"      </code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># match again with exact region pairing </span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>mout5 <span class="ot">&lt;-</span> <span class="fu">Match</span>(<span class="at">Tr=</span>Tr[indx], <span class="at">X=</span>X2[indx,], <span class="at">estimand=</span><span class="st">"ATT"</span>, <span class="at">exact=</span>exactX)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mout5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Estimate...  0 
SE.........  0 
T-stat.....  NaN 
p.val......  NA 

Original number of observations..............  86 
Original number of treated obs...............  30 
Matched number of observations...............  20 
Matched number of observations  (unweighted).  20 

Number of obs dropped by 'exact' or 'caliper'  10 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">MatchBalance</span>(Tr[indx] <span class="sc">~</span> . , <span class="at">data =</span> X2[indx,], <span class="at">match.out=</span>mout5, <span class="at">nboots=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
***** (V1) `Violent Independenc` *****
                       Before Matching       After Matching
mean treatment........    0.63333               0.6 
mean control..........        0.5               0.2 
std mean diff.........     27.204            79.582 

mean raw eQQ diff.....    0.13333               0.4 
med  raw eQQ diff.....          0                 0 
max  raw eQQ diff.....          1                 1 

mean eCDF diff........   0.066667               0.2 
med  eCDF diff........   0.066667               0.2 
max  eCDF diff........    0.13333               0.4 

var ratio (Tr/Co).....    0.94376               1.5 
T-test p-value........    0.23865         0.0016974 


***** (V2) `Year of Independence` *****
                       Before Matching       After Matching
mean treatment........     1882.7            1912.9 
mean control..........     1826.1            1954.7 
std mean diff.........     81.576           -62.617 

mean raw eQQ diff.....     134.53              43.5 
med  raw eQQ diff.....         53              14.5 
max  raw eQQ diff.....        840               127 

mean eCDF diff........    0.13314           0.17381 
med  eCDF diff........    0.11667               0.2 
max  eCDF diff........    0.31667               0.4 

var ratio (Tr/Co).....   0.070412            9.6233 
T-test p-value........    0.13242          0.018361 
KS Bootstrap p-value.. &lt; 2.22e-16        &lt; 2.22e-16 
KS Naive p-value......   0.023689          0.045888 
KS Statistic..........    0.31667               0.4 


***** (V3) `Independency by Decolonization` *****
                       Before Matching       After Matching
mean treatment........    0.63333               0.6 
mean control..........    0.46429               0.9 
std mean diff.........      34.49           -59.687 

mean raw eQQ diff.....    0.16667               0.3 
med  raw eQQ diff.....          0                 0 
max  raw eQQ diff.....          1                 1 

mean eCDF diff........   0.084524              0.15 
med  eCDF diff........   0.084524              0.15 
max  eCDF diff........    0.16905               0.3 

var ratio (Tr/Co).....     0.9486            2.6667 
T-test p-value........    0.13617         0.0086361 


***** (V4) `Independence by Secession` *****
                       Before Matching       After Matching
mean treatment........    0.33333              0.35 
mean control..........    0.23214               0.1 
std mean diff.........     21.105            51.087 

mean raw eQQ diff.....        0.1              0.25 
med  raw eQQ diff.....          0                 0 
max  raw eQQ diff.....          1                 1 

mean eCDF diff........   0.050595             0.125 
med  eCDF diff........   0.050595             0.125 
max  eCDF diff........    0.10119              0.25 

var ratio (Tr/Co).....     1.2666            2.5278 
T-test p-value........    0.33686          0.050785 


***** (V5) `Ethic Fractionalization` *****
                       Before Matching       After Matching
mean treatment........    0.48523           0.50032 
mean control..........    0.35836           0.51093 
std mean diff.........     55.492            -4.463 

mean raw eQQ diff.....     0.1415          0.072524 
med  raw eQQ diff.....    0.12276          0.046989 
max  raw eQQ diff.....     0.2612           0.24974 

mean eCDF diff........    0.16375          0.098333 
med  eCDF diff........    0.15714               0.1 
max  eCDF diff........    0.37857              0.25 

var ratio (Tr/Co).....    0.99957            1.6511 
T-test p-value........   0.017142           0.76341 
KS Bootstrap p-value.. &lt; 2.22e-16               0.2 
KS Naive p-value......  0.0050673           0.51186 
KS Statistic..........    0.37857              0.25 


***** (V6) `Linguistic Fractionalization` *****
                       Before Matching       After Matching
mean treatment........    0.36042           0.45297 
mean control..........    0.33199           0.44779 
std mean diff.........      9.407            1.6561 

mean raw eQQ diff.....   0.052711          0.084695 
med  raw eQQ diff.....   0.023094           0.06169 
max  raw eQQ diff.....    0.18848           0.27104 

mean eCDF diff........   0.055482             0.105 
med  eCDF diff........   0.039881               0.1 
max  eCDF diff........    0.20833              0.25 

var ratio (Tr/Co).....     1.4833           0.86807 
T-test p-value........    0.66065           0.88091 
KS Bootstrap p-value..        0.2               0.2 
KS Naive p-value......    0.31127             0.502 
KS Statistic..........    0.20833              0.25 


***** (V7) `Religious Fractionalization` *****
                       Before Matching       After Matching
mean treatment........    0.38572           0.44798 
mean control..........     0.4431           0.56804 
std mean diff.........    -25.044           -50.042 

mean raw eQQ diff.....   0.074969           0.12007 
med  raw eQQ diff.....   0.053677          0.088513 
max  raw eQQ diff.....    0.17146           0.30412 

mean eCDF diff........   0.089106           0.13667 
med  eCDF diff........     0.0625               0.1 
max  eCDF diff........    0.27381              0.35 

var ratio (Tr/Co).....     1.0062            1.1251 
T-test p-value........    0.27231          0.031915 
KS Bootstrap p-value..        0.2               0.1 
KS Naive p-value......   0.085347           0.15913 
KS Statistic..........    0.27381              0.35 


***** (V8) `Life expectancy 1800` *****
                       Before Matching       After Matching
mean treatment........     31.531            30.726 
mean control..........     33.279            31.717 
std mean diff.........    -48.136           -23.898 

mean raw eQQ diff.....     1.6086            1.9916 
med  raw eQQ diff.....     1.6776             2.189 
max  raw eQQ diff.....        3.1               4.3 

mean eCDF diff........    0.13347           0.15179 
med  eCDF diff........    0.11071             0.125 
max  eCDF diff........    0.33571              0.35 

var ratio (Tr/Co).....    0.89741            1.5235 
T-test p-value........   0.041052           0.27411 
KS Bootstrap p-value.. &lt; 2.22e-16               0.1 
KS Naive p-value......   0.016592           0.15476 
KS Statistic..........    0.33571              0.35 


***** (V9) `GDP per cap 1800` *****
                       Before Matching       After Matching
mean treatment........     884.67             869.9 
mean control..........     1215.1            1129.4 
std mean diff.........    -103.91           -70.669 

mean raw eQQ diff.....      327.8             304.7 
med  raw eQQ diff.....      269.5               212 
max  raw eQQ diff.....        796               741 

mean eCDF diff........    0.17895           0.21167 
med  eCDF diff........    0.12738               0.2 
max  eCDF diff........    0.45357               0.5 

var ratio (Tr/Co).....    0.33049           0.83115 
T-test p-value........ 0.00071184         0.0096143 
KS Bootstrap p-value.. &lt; 2.22e-16        &lt; 2.22e-16 
KS Naive p-value...... 0.00035765          0.010558 
KS Statistic..........    0.45357               0.5 


***** (V10) `Country in America` *****
                       Before Matching       After Matching
mean treatment........        0.6               0.4 
mean control..........   0.053571               0.4 
std mean diff.........     109.66                 0 

mean raw eQQ diff.....    0.53333                 0 
med  raw eQQ diff.....          1                 0 
max  raw eQQ diff.....          1                 0 

mean eCDF diff........    0.27321                 0 
med  eCDF diff........    0.27321                 0 
max  eCDF diff........    0.54643                 0 

var ratio (Tr/Co).....     4.8094                 1 
T-test p-value........ 1.8303e-06                 1 


***** (V11) `Country in South America` *****
                       Before Matching       After Matching
mean treatment........    0.33333                 0 
mean control..........          0                 0 
std mean diff.........     69.522                 0 

mean raw eQQ diff.....    0.33333                 0 
med  raw eQQ diff.....          0                 0 
max  raw eQQ diff.....          1                 0 

mean eCDF diff........    0.16667                 0 
med  eCDF diff........    0.16667                 0 
max  eCDF diff........    0.33333                 0 

var ratio (Tr/Co).....        Inf               NaN 
T-test p-value........ 0.00067228                 1 


***** (V12) `Country in Europe` *****
                       Before Matching       After Matching
mean treatment........   0.033333              0.05 
mean control..........    0.51786              0.05 
std mean diff.........    -265.38                 0 

mean raw eQQ diff.....    0.46667                 0 
med  raw eQQ diff.....          0                 0 
max  raw eQQ diff.....          1                 0 

mean eCDF diff........    0.24226                 0 
med  eCDF diff........    0.24226                 0 
max  eCDF diff........    0.48452                 0 

var ratio (Tr/Co).....    0.13112                 1 
T-test p-value........ 9.3222e-09                 1 


***** (V13) `Country in Africa` *****
                       Before Matching       After Matching
mean treatment........    0.23333              0.35 
mean control..........      0.125              0.35 
std mean diff.........     25.183                 0 

mean raw eQQ diff.....        0.1                 0 
med  raw eQQ diff.....          0                 0 
max  raw eQQ diff.....          1                 0 

mean eCDF diff........   0.054167                 0 
med  eCDF diff........   0.054167                 0 
max  eCDF diff........    0.10833                 0 

var ratio (Tr/Co).....     1.6617                 1 
T-test p-value........    0.23622                 1 


***** (V14) `Country in Asia` *****
                       Before Matching       After Matching
mean treatment........    0.13333               0.2 
mean control..........    0.23214               0.2 
std mean diff.........    -28.579                 0 

mean raw eQQ diff.....        0.1                 0 
med  raw eQQ diff.....          0                 0 
max  raw eQQ diff.....          1                 0 

mean eCDF diff........   0.049405                 0 
med  eCDF diff........   0.049405                 0 
max  eCDF diff........    0.09881                 0 

var ratio (Tr/Co).....    0.65865                 1 
T-test p-value........    0.24898                 1 


***** (V15) `Country in Oceania` *****
                       Before Matching       After Matching
mean treatment........          0                 0 
mean control..........   0.071429                 0 
std mean diff.........       -Inf                 0 

mean raw eQQ diff.....   0.066667                 0 
med  raw eQQ diff.....          0                 0 
max  raw eQQ diff.....          1                 0 

mean eCDF diff........   0.035714                 0 
med  eCDF diff........   0.035714                 0 
max  eCDF diff........   0.071429                 0 

var ratio (Tr/Co).....          0               NaN 
T-test p-value........   0.044453                 1 


Before Matching Minimum p.value: &lt; 2.22e-16 
Variable Name(s): `Year of Independence` `Ethic Fractionalization` `Life expectancy 1800` `GDP per cap 1800`  Number(s): 2 5 8 9 

After Matching Minimum p.value: &lt; 2.22e-16 
Variable Name(s): `Year of Independence` `GDP per cap 1800`  Number(s): 2 9 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>mdataTr <span class="ot">=</span> data[indx,][mout5<span class="sc">$</span>index.treated,]</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>mdataCo <span class="ot">=</span> data[indx,][mout5<span class="sc">$</span>index.control,]</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Now look at Jamaica</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(mdataTr<span class="sc">$</span>country, mdataCo<span class="sc">$</span>country)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      mdataTr.country     mdataCo.country
1               BENIN        SOUTH AFRICA
2          COSTA RICA             JAMAICA
3              CYPRUS              ISRAEL
4  DOMINICAN REPUBLIC             JAMAICA
5              GAMBIA                MALI
6               GHANA           MAURITIUS
7           GUATEMALA TRINIDAD AND TOBAGO
8            HONDURAS             JAMAICA
9           INDONESIA              ISRAEL
10        KOREA SOUTH          BANGLADESH
11             MALAWI        SOUTH AFRICA
12             MEXICO             JAMAICA
13            NAMIBIA          MOZAMBIQUE
14          NICARAGUA TRINIDAD AND TOBAGO
15             PANAMA             JAMAICA
16        PHILIPPINES               INDIA
17            SENEGAL                MALI
18            UKRAINE           MACEDONIA
19      UNITED STATES             JAMAICA
20             ZAMBIA        SOUTH AFRICA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>ii <span class="ot">=</span> (data<span class="sc">$</span>country <span class="sc">==</span> <span class="st">"JAMAICA"</span> <span class="sc">|</span> data<span class="sc">$</span>country <span class="sc">==</span> <span class="st">"COSTA RICA"</span> <span class="sc">|</span> data<span class="sc">$</span>country <span class="sc">==</span> <span class="st">"MEXICO"</span>)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="fu">as.character</span>(data<span class="sc">$</span>country[ii]),X2[ii,])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  as.character.data.country.ii.. Violent.Independenc Year.of.Independence
1                     COSTA RICA                   1                 1838
2                        JAMAICA                   0                 1962
3                         MEXICO                   1                 1821
  Independency.by.Decolonization Independence.by.Secession
1                              0                         1
2                              1                         0
3                              1                         0
  Ethic.Fractionalization Linguistic.Fractionalization
1                0.236800                    0.0489116
2                0.412894                    0.1098046
3                0.541800                    0.1511190
  Religious.Fractionalization Life.expectancy.1800 GDP.per.cap.1800
1                   0.2409582              30.2147              812
2                   0.6159606              34.2000             1644
3                   0.1795571              26.9000             1420
  Country.in.America Country.in.South.America Country.in.Europe
1                  1                        0                 0
2                  1                        0                 0
3                  1                        0                 0
  Country.in.Africa Country.in.Asia Country.in.Oceania
1                 0               0                  0
2                 0               0                  0
3                 0               0                  0</code></pre>
</div>
</div>
</section>
<section id="comparing-ols-with-matched-difference-of-means" class="level3">
<h3 class="anchored" data-anchor-id="comparing-ols-with-matched-difference-of-means">Comparing OLS with Matched Difference of Means</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Outcome 1: President/PM held party position immediately prior</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>indx2 <span class="ot">=</span> indx <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(data<span class="sc">$</span>prexpty) <span class="co"># index for full observations from X2 and our variable of interest</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="co"># matching ATT</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>mout <span class="ot">&lt;-</span> <span class="fu">Match</span>(<span class="at">Y=</span>data<span class="sc">$</span>prexpty[indx2], <span class="at">Tr=</span>Tr[indx2], <span class="at">X=</span>X2[indx2,], <span class="at">estimand=</span><span class="st">"ATT"</span>)</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mout)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Estimate...  -0.42857 
AI SE......  0.16342 
T-stat.....  -2.6224 
p.val......  0.0087303 

Original number of observations..............  82 
Original number of treated obs...............  28 
Matched number of observations...............  28 
Matched number of observations  (unweighted).  28 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(data<span class="sc">$</span>prexpty[Tr<span class="sc">==</span><span class="dv">1</span>],data<span class="sc">$</span>prexpty[Tr<span class="sc">==</span><span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  data$prexpty[Tr == 1] and data$prexpty[Tr == 0]
t = -0.731, df = 64.438, p-value = 0.4674
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -0.2316728  0.1075349
sample estimates:
mean of x mean of y 
 0.137931  0.200000 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>att_df <span class="ot">&lt;-</span> <span class="fu">cbind.data.frame</span>( <span class="at">prexpty =</span> data<span class="sc">$</span>prexpty[indx2],</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Tr =</span> <span class="fu">as.numeric</span>(Tr[indx2])) <span class="sc">%&gt;%</span> <span class="fu">tibble</span>()</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>stats<span class="sc">::</span><span class="fu">lm</span>(prexpty <span class="sc">~</span> Tr, <span class="at">data =</span> att_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
stats::lm(formula = prexpty ~ Tr, data = att_df)

Coefficients:
(Intercept)           Tr  
    0.20370     -0.06085  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(data<span class="sc">$</span>prexpty[indx2]<span class="sc">~</span> <span class="fu">as.numeric</span>(Tr[indx2]) <span class="sc">+</span> <span class="fu">as.matrix</span>(X2[indx2,])))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = data$prexpty[indx2] ~ as.numeric(Tr[indx2]) + as.matrix(X2[indx2, 
    ]))

Residuals:
    Min      1Q  Median      3Q     Max 
-0.5074 -0.2009 -0.1208 -0.0032  0.9050 

Coefficients: (1 not defined because of singularities)
                                                       Estimate Std. Error
(Intercept)                                          -6.817e-01  6.974e-01
as.numeric(Tr[indx2])                                -2.156e-01  1.484e-01
as.matrix(X2[indx2, ])Violent Independenc             5.575e-02  1.056e-01
as.matrix(X2[indx2, ])Year of Independence            3.643e-04  2.885e-04
as.matrix(X2[indx2, ])Independency by Decolonization -1.751e-02  1.580e-01
as.matrix(X2[indx2, ])Independence by Secession      -7.567e-02  1.710e-01
as.matrix(X2[indx2, ])Ethic Fractionalization         6.112e-02  2.946e-01
as.matrix(X2[indx2, ])Linguistic Fractionalization   -1.617e-01  2.532e-01
as.matrix(X2[indx2, ])Religious Fractionalization     3.356e-01  2.381e-01
as.matrix(X2[indx2, ])Life expectancy 1800            3.274e-04  1.493e-02
as.matrix(X2[indx2, ])GDP per cap 1800                4.305e-05  1.393e-04
as.matrix(X2[indx2, ])Country in America              2.315e-01  3.196e-01
as.matrix(X2[indx2, ])Country in South America       -2.853e-02  1.957e-01
as.matrix(X2[indx2, ])Country in Europe              -5.376e-02  2.695e-01
as.matrix(X2[indx2, ])Country in Africa               2.320e-01  2.844e-01
as.matrix(X2[indx2, ])Country in Asia                 1.141e-01  2.581e-01
as.matrix(X2[indx2, ])Country in Oceania                     NA         NA
                                                     t value Pr(&gt;|t|)
(Intercept)                                           -0.978    0.332
as.numeric(Tr[indx2])                                 -1.453    0.151
as.matrix(X2[indx2, ])Violent Independenc              0.528    0.599
as.matrix(X2[indx2, ])Year of Independence             1.263    0.211
as.matrix(X2[indx2, ])Independency by Decolonization  -0.111    0.912
as.matrix(X2[indx2, ])Independence by Secession       -0.442    0.660
as.matrix(X2[indx2, ])Ethic Fractionalization          0.207    0.836
as.matrix(X2[indx2, ])Linguistic Fractionalization    -0.639    0.525
as.matrix(X2[indx2, ])Religious Fractionalization      1.410    0.163
as.matrix(X2[indx2, ])Life expectancy 1800             0.022    0.983
as.matrix(X2[indx2, ])GDP per cap 1800                 0.309    0.758
as.matrix(X2[indx2, ])Country in America               0.724    0.471
as.matrix(X2[indx2, ])Country in South America        -0.146    0.885
as.matrix(X2[indx2, ])Country in Europe               -0.200    0.842
as.matrix(X2[indx2, ])Country in Africa                0.816    0.418
as.matrix(X2[indx2, ])Country in Asia                  0.442    0.660
as.matrix(X2[indx2, ])Country in Oceania                  NA       NA

Residual standard error: 0.3958 on 66 degrees of freedom
Multiple R-squared:  0.1563,    Adjusted R-squared:  -0.03543 
F-statistic: 0.8152 on 15 and 66 DF,  p-value: 0.6572</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="do">## OLS versus Matching (paying attention to South America dummy)</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>indx2 <span class="ot">=</span> indx <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(data<span class="sc">$</span>prexpty)</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>mout2 <span class="ot">&lt;-</span> <span class="fu">Match</span>(<span class="at">Y=</span>data<span class="sc">$</span>prexpty[indx2], <span class="at">Tr=</span>Tr[indx2], <span class="at">X=</span>X2[indx2,<span class="dv">11</span>], <span class="at">estimand=</span><span class="st">"ATT"</span>)</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mout2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Estimate...  -0.060847 
AI SE......  0.083155 
T-stat.....  -0.73172 
p.val......  0.46434 

Original number of observations..............  82 
Original number of treated obs...............  28 
Matched number of observations...............  28 
Matched number of observations  (unweighted).  1512 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">MatchBalance</span>(Tr[indx2] <span class="sc">~</span>. , <span class="at">data =</span>  X2[indx2,<span class="dv">11</span>], <span class="at">match.out=</span>mout2, <span class="at">nboots=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
***** (V1) `Country in South America` *****
                       Before Matching       After Matching
mean treatment........    0.32143           0.32143 
mean control..........          0                 0 
std mean diff.........     67.585            67.585 

mean raw eQQ diff.....    0.32143           0.32143 
med  raw eQQ diff.....          0                 0 
max  raw eQQ diff.....          1                 1 

mean eCDF diff........    0.16071           0.16071 
med  eCDF diff........    0.16071           0.16071 
max  eCDF diff........    0.32143           0.32143 

var ratio (Tr/Co).....        Inf               Inf 
T-test p-value........   0.001342         0.0011322 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co">#South America does not has a control group</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(data<span class="sc">$</span>prexpty[indx2]<span class="sc">~</span> <span class="fu">as.numeric</span>(Tr[indx2]) <span class="sc">+</span> <span class="fu">as.matrix</span>(X2[indx2,<span class="dv">11</span>])))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = data$prexpty[indx2] ~ as.numeric(Tr[indx2]) + as.matrix(X2[indx2, 
    11]))

Residuals:
    Min      1Q  Median      3Q     Max 
-0.2037 -0.2037 -0.2037 -0.1111  0.8889 

Coefficients:
                         Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)               0.20370    0.05342   3.813 0.000271 ***
as.numeric(Tr[indx2])    -0.04581    0.10471  -0.437 0.662962    
as.matrix(X2[indx2, 11]) -0.04678    0.15885  -0.295 0.769140    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.3926 on 79 degrees of freedom
Multiple R-squared:  0.006661,  Adjusted R-squared:  -0.01849 
F-statistic: 0.2649 on 2 and 79 DF,  p-value: 0.768</code></pre>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(data<span class="sc">$</span>prexpty[indx2]<span class="sc">~</span> <span class="fu">as.numeric</span>(Tr[indx2])))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = data$prexpty[indx2] ~ as.numeric(Tr[indx2]))

Residuals:
    Min      1Q  Median      3Q     Max 
-0.2037 -0.2037 -0.2037 -0.1429  0.8571 

Coefficients:
                      Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)            0.20370    0.05312   3.835 0.000249 ***
as.numeric(Tr[indx2]) -0.06085    0.09090  -0.669 0.505167    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.3903 on 80 degrees of freedom
Multiple R-squared:  0.00557,   Adjusted R-squared:  -0.00686 
F-statistic: 0.4481 on 1 and 80 DF,  p-value: 0.5052</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>linreg <span class="ot">&lt;-</span> <span class="fu">lm</span>(data<span class="sc">$</span>prexpty[indx2]<span class="sc">~</span> <span class="fu">as.numeric</span>(Tr[indx2]) <span class="sc">+</span> <span class="fu">as.matrix</span>(X2[indx2,]))</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Linear regression effect is"</span>, <span class="fu">summary</span>(linreg)<span class="sc">$</span>coefficients[<span class="dv">2</span>,<span class="dv">1</span>], <span class="st">" with p-value"</span>, </span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summary</span>(linreg)<span class="sc">$</span>coefficients[<span class="dv">2</span>,<span class="dv">4</span>] ,<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear regression effect is -0.2155648  with p-value 0.1509716 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Matching effect is"</span>, mout<span class="sc">$</span>est, <span class="st">"with p-value"</span>,  <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span><span class="fu">pnorm</span>(<span class="fu">abs</span>(mout<span class="sc">$</span>est<span class="sc">/</span>mout<span class="sc">$</span>se))),<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Matching effect is -0.4285714 with p-value 0.008730257 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Outcome 2: President/PM was member of parliament immediately prior to taking office </span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>indx2 <span class="ot">=</span> indx <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(data<span class="sc">$</span>prexmp)</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>mout <span class="ot">&lt;-</span> <span class="fu">Match</span>(<span class="at">Y=</span>data<span class="sc">$</span>prexmp[indx2], <span class="at">Tr=</span>Tr[indx2], <span class="at">X=</span>X2[indx2,], <span class="at">estimand=</span><span class="st">"ATT"</span>)</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mout)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Estimate...  -0.32143 
AI SE......  0.18629 
T-stat.....  -1.7255 
p.val......  0.084444 

Original number of observations..............  82 
Original number of treated obs...............  28 
Matched number of observations...............  28 
Matched number of observations  (unweighted).  28 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(data<span class="sc">$</span>prexmp[Tr<span class="sc">==</span><span class="dv">1</span>],data<span class="sc">$</span>prexmp[Tr<span class="sc">==</span><span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  data$prexmp[Tr == 1] and data$prexmp[Tr == 0]
t = -1.8512, df = 64.388, p-value = 0.06873
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -0.40538134  0.01541269
sample estimates:
mean of x mean of y 
0.2413793 0.4363636 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>linreg2 <span class="ot">&lt;-</span> <span class="fu">summary</span>(<span class="fu">lm</span>(data<span class="sc">$</span>prexmp[indx2]<span class="sc">~</span> <span class="fu">as.numeric</span>(Tr[indx2]) <span class="sc">+</span> <span class="fu">as.matrix</span>(X2[indx2,])))</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Linear regression effect is"</span>, linreg2<span class="sc">$</span>coefficients[<span class="dv">2</span>,<span class="dv">1</span>], <span class="st">" with p-value"</span>, </span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>    linreg2<span class="sc">$</span>coefficients[<span class="dv">2</span>,<span class="dv">4</span>],<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear regression effect is -0.4289868  with p-value 0.01406203 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Matching effect is"</span>, mout<span class="sc">$</span>est, <span class="st">"with p-value"</span>,  <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span><span class="fu">pnorm</span>(<span class="fu">abs</span>(mout<span class="sc">$</span>est<span class="sc">/</span>mout<span class="sc">$</span>se))),<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Matching effect is -0.3214286 with p-value 0.08444445 </code></pre>
</div>
</div>
</section>
</section>
<section id="additional-links" class="level2">
<h2 class="anchored" data-anchor-id="additional-links">Additional Links</h2>
<ol type="1">
<li>Matching in <a href="https://theeffectbook.net/ch-Matching.html"><em>The Effect Book</em></a>.</li>
<li>Matching and Subclassification in <a href="https://mixtape.scunning.com/05-matching_and_subclassification"><em>Causal Inference: The Mixtape</em></a>.</li>
<li><a href="https://cran.r-project.org/web/packages/MatchIt/vignettes/MatchIt.html"><em>MatchIt</em> Package</a>.</li>
</ol>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-cunninghamCausalInferenceMixtape" class="csl-entry" role="listitem">
Cunningham, Scott. n.d. <span>“Causal Inference the Mixtape - 5&nbsp; Matching and Subclassification.”</span> In. <a href="https://mixtape.scunning.com/05-matching_and_subclassification">https://mixtape.scunning.com/05-matching_and_subclassification</a>.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./matching-equivalence.html" class="pagination-link" aria-label="Session 2 - Matching and Equivalence">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Session 2 - Matching and Equivalence</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./equivalence.html" class="pagination-link" aria-label="Equivalence">
        <span class="nav-page-text">Equivalence</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>